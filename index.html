<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy - Toss Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face {
            font-family: 'TossFaceFontMac';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface-font-mac.css');
        }

        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            background-color: #000; 
            color: #191F28;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        /* ìœ ë¦¬ ì¬ì§ˆ ê³µí†µ í´ë˜ìŠ¤ (ê¸°ë³¸í˜•) 
           - ê¸°ì¡´ .toss-cardë¥¼ ìœ ë¦¬ ëŠë‚Œìœ¼ë¡œ ì „ë©´ êµì²´
        */
        .toss-card {
            background: rgba(255, 255, 255, 0.65); /* ë°˜íˆ¬ëª… í°ìƒ‰ */
            backdrop-filter: blur(12px) saturate(180%); /* ë¸”ëŸ¬ ë° ì±„ë„ ì¦ê°€ */
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6); /* ìœ ë¦¬ í…Œë‘ë¦¬ */
            border-radius: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04); 
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        .toss-card:active {
            transform: scale(0.96);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.02);
        }

        /* ìœ ë¦¬ ìŠ¤íƒ€ì¼ ì¹´ë“œ (ì¼ì • í™”ë©´ìš©, ë” íˆ¬ëª…í•¨) */
        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border-radius: 24px;
        }

        /* í…ìŠ¤íŠ¸ ì»¬ëŸ¬ ì‹œìŠ¤í…œ */
        .text-main { color: #191F28; }
        .text-sub { color: #6B7684; } /* ìœ ë¦¬ì—ì„  ì¡°ê¸ˆ ë” ì§„í•´ì•¼ ê°€ë…ì„± ì¢‹ìŒ */
        .text-blue { color: #3182F6; }
        .text-red { color: #F04452; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe-area { padding-bottom: env(safe-area-inset-bottom); } 
        
        .price-up { color: #F04452 !important; transition: color 0.3s; }
        .price-down { color: #3182F6 !important; transition: color 0.3s; }

        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .bg-emoji {
            animation: floatEmoji 6s ease-in-out infinite;
            filter: blur(0px); 
        }

        .screen-transition {
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.4s ease, border-radius 0.4s ease;
        }
        
        .home-scaled-down {
            transform: scale(0.92) translateY(-10px);
            opacity: 0.8;
            border-radius: 32px;
            overflow: hidden; 
            pointer-events: none;
        }
    </style>
</head>
<body class="w-full h-[100dvh] flex flex-col overflow-hidden bg-black">

    <!-- ë©”ì¸ ì»¨í…ì¸  (í™ˆ í™”ë©´) -->
    <!-- ë°°ê²½ì— ê·¸ë¼ë°ì´ì…˜ì„ ì€ì€í•˜ê²Œ ê¹”ì•„ ìœ ë¦¬ì˜ íˆ¬ëª…í•¨ì„ ê°•ì¡° -->
    <main id="home-screen" class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-safe pb-32 w-full max-w-md mx-auto relative bg-gradient-to-br from-[#F2F4F6] via-[#E8ECF2] to-[#DEE2E6] min-h-full shadow-2xl screen-transition origin-top z-10">
        
        <!-- ğŸ‘‹ ìƒë‹¨ ì¸ì‚¬ë§ -->
        <div class="mb-6 mt-4 fade-in-up relative h-24 flex flex-col justify-center overflow-visible">
            <div id="bg-emoji" class="bg-emoji absolute right-0 bottom-[-10px] text-[80px] opacity-20 select-none pointer-events-none z-0 transform translate-x-2"></div>
            <div class="relative z-10">
                <h1 class="text-2xl font-bold text-main leading-tight mb-1">ì—”ì¡°ì´ ì—¬ëŸ¬ë¶„,</h1>
                <p id="time-msg" class="text-2xl font-bold text-main leading-tight opacity-90"></p>
            </div>
        </div>

        <!-- ì„¹ì…˜ 1: ìì‚°/ì£¼ì‹ (ìœ ë¦¬ ì¹´ë“œ ì ìš©ë¨) -->
        <div class="toss-card p-6 mb-4 fade-in-up delay-100 group" onclick="checkStock()">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-main">ì—”ì¡°ì´ ì¦ê¶Œ</h2>
                <i class="fa-solid fa-chevron-right text-sub text-xs group-hover:translate-x-1 transition-transform"></i>
            </div>
            
            <div class="flex items-center justify-between relative z-10 pb-2">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-blue-50/80 flex items-center justify-center text-blue-500 text-xl shadow-sm">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <p class="text-sm font-medium text-sub">ì—”ì¡°ì´</p> 
                            <span id="market-badge" class="hidden text-[10px] font-bold bg-gray-100/80 text-gray-500 px-1.5 py-0.5 rounded-md">ë§ˆê°</span>
                        </div>
                        <div class="flex items-end gap-2">
                            <h3 id="ticker-price" class="text-2xl font-bold text-main tabular-nums tracking-tight">Loading...</h3>
                            <span id="ticker-change" class="text-sm font-medium text-sub mb-1 tabular-nums">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë°°ê²½ ì°¨íŠ¸ -->
            <div class="absolute bottom-0 right-0 w-[60%] h-[50%] opacity-20 pointer-events-none">
                 <svg id="mini-chart" width="100%" height="100%" preserveAspectRatio="none" class="overflow-visible">
                    <defs>
                        <linearGradient id="chart-grad" x1="0" x2="0" y1="0" y2="1">
                            <stop offset="0%" stop-color="#3182F6" stop-opacity="0.5"/>
                            <stop offset="100%" stop-color="#3182F6" stop-opacity="0"/>
                        </linearGradient>
                    </defs>
                    <path id="chart-fill" d="" fill="url(#chart-grad)"></path>
                    <polyline id="chart-line" points="" fill="none" stroke="#3182F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline>
                 </svg>
            </div>
        </div>

        <!-- ì„¹ì…˜ 2: ì—”ì¡°ì´ ì„œë¹„ìŠ¤ -->
        <h3 class="text-lg font-bold text-main mb-3 px-1 fade-in-up delay-200">ì—”ì¡°ì´ ì„œë¹„ìŠ¤</h3>
        
        <!-- 1. ë©”ì¸ ì„œë¹„ìŠ¤ (ìŒì•…) - ìœ ë¦¬ ì¬ì§ˆ + ì»¬ëŸ¬ í‹´íŠ¸ ì ìš© -->
        <div class="mb-3 fade-in-up delay-200">
            <!-- bg-[#E8F3FF] -> bg-[#E8F3FF]/60 + backdrop-blur -->
            <button onclick="goToMusic()" class="toss-card w-full p-6 flex flex-row-reverse items-center justify-between group overflow-hidden relative h-32 !bg-[#E8F3FF]/60 backdrop-blur-md border border-white/60">
                <div class="relative z-10 w-16 h-16 rounded-full bg-white/70 backdrop-blur-sm shadow-sm flex items-center justify-center text-blue-500 text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="fa-solid fa-headphones"></i>
                </div>
                <div class="relative z-10 text-left flex-1 pr-4">
                    <div class="flex items-center gap-1.5 mb-1.5">
                        <span class="text-[10px] font-bold text-blue-500 bg-white/70 px-1.5 py-0.5 rounded-md">TODAY</span>
                        <span class="w-1 h-1 rounded-full bg-blue-500"></span>
                        <span class="text-[10px] font-medium text-blue-400">ìŒì•…</span>
                    </div>
                    <h4 class="text-xl font-bold text-main leading-tight mb-1">ì—”ì¡°ì´ ë¸Œì´ë¡œê·¸ ì†<br>ìŒì•… ë“£ê¸°</h4>
                </div>
            </button>
        </div>

        <!-- 2. ì„œë¸Œ ì„œë¹„ìŠ¤ (ê²Œì„, ì—¬í–‰) - ìœ ë¦¬ ì¬ì§ˆ + ì»¬ëŸ¬ í‹´íŠ¸ -->
        <div class="grid grid-cols-2 gap-3 mb-3 fade-in-up delay-200">
            <!-- ê²Œì„ -->
            <button onclick="playGame()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group !bg-[#FFF0F0]/60 backdrop-blur-md border border-white/60 hover:!bg-[#FFE5E5]/70 transition-colors">
                <div class="w-full flex justify-between items-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 backdrop-blur-sm flex items-center justify-center text-[#FF6B6B] text-xl group-hover:rotate-12 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-dice"></i>
                    </div>
                    <span class="bg-[#FF6B6B] text-white text-[9px] font-bold px-1.5 py-0.5 rounded-md tracking-tight">NEW</span>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-main mb-1">ì—”ì¡°ì´ ë³µë¶ˆë³µ</h4>
                    <p class="text-xs text-[#FF6B6B]/90 font-medium leading-snug">ì—”ì¡°ì´ì˜<br>ìš´ëª…ì€?</p>
                </div>
            </button>

            <!-- ì—¬í–‰ -->
            <button onclick="showTravelModal()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group !bg-[#E3FAEB]/60 backdrop-blur-md border border-white/60 hover:!bg-[#D1F7DE]/70 transition-colors">
                <div class="w-full flex justify-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 backdrop-blur-sm flex items-center justify-center text-[#00C77D] text-xl group-hover:scale-110 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-plane-departure"></i>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-main mb-1">ì—¬í–‰ ê¸°ë¡</h4>
                    <p class="text-xs text-[#00C77D]/90 font-medium leading-snug">ì§€ë‚œ ì¶”ì–µì„<br>ë– ì˜¬ë ¤ë´ìš”</p>
                </div>
            </button>
        </div>

        <!-- 3. ê¸°íƒ€ (ì¤€ë¹„ ì¤‘) -->
        <div class="mb-6 fade-in-up delay-200">
            <!-- ì¼ë°˜ toss-card í´ë˜ìŠ¤ ì‚¬ìš© (ê¸°ë³¸ ìœ ë¦¬ ìŠ¤íƒ€ì¼) -->
            <button onclick="showSecretModal()" class="toss-card w-full h-14 !p-0 px-5 flex items-center justify-between group hover:bg-white/40 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-100/80 text-gray-400 flex items-center justify-center text-xs">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-500">ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘</span>
                </div>
                <div class="text-xs text-gray-400 font-medium flex items-center gap-1">
                    Comming Soon <i class="fa-solid fa-chevron-right text-[10px]"></i>
                </div>
            </button>
        </div>

        <div class="mt-8 text-center pb-8">
            <button class="text-xs text-sub underline hover:text-gray-600">í™”ë©´ í¸ì§‘í•˜ê¸°</button>
            <p class="text-[10px] text-gray-400 mt-4">Â© 2024 Enjoy Corp.</p>
        </div>
    </main>

    <!-- ğŸ“… ì¼ì • í™”ë©´ -->
    <div id="schedule-screen" class="fixed top-0 bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md z-30 bg-gradient-to-br from-[#F5F7FA] via-[#F2F4F6] to-[#E9ECEF] flex flex-col overflow-hidden shadow-2xl screen-transition translate-x-full rounded-l-[0px]">
        
        <!-- í—¤ë” -->
        <header class="flex-none pt-safe px-6 pb-4 flex justify-between items-center bg-white/30 backdrop-blur-md border-b border-white/20 z-10 sticky top-0">
            <h2 class="text-2xl font-bold text-main drop-shadow-sm">ì¼ì •</h2>
            <div class="flex gap-2">
                <button onclick="changeMonth(-1)" class="w-8 h-8 rounded-full bg-white/40 hover:bg-white/60 backdrop-blur-sm flex items-center justify-center text-gray-700 shadow-sm transition-colors"><i class="fa-solid fa-chevron-left"></i></button>
                <span id="cal-title" class="text-lg font-bold text-main tabular-nums flex items-center drop-shadow-sm">2024.05</span>
                <button onclick="changeMonth(1)" class="w-8 h-8 rounded-full bg-white/40 hover:bg-white/60 backdrop-blur-sm flex items-center justify-center text-gray-700 shadow-sm transition-colors"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
        </header>

        <!-- ìº˜ë¦°ë” ì˜ì—­ -->
        <div class="flex-1 overflow-y-auto scrollbar-hide px-4 pt-4">
            <!-- ë‹¬ë ¥ ì»¨í…Œì´ë„ˆ -->
            <div class="bg-white/40 backdrop-blur-md border border-white/40 rounded-[32px] shadow-lg mb-6 pb-6 ring-1 ring-white/30">
                <div class="grid grid-cols-7 text-center mb-2 px-4 pt-4">
                    <div class="text-xs text-red-500 font-bold py-2">ì¼</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ì›”</div>
                    <div class="text-xs text-gray-600 font-medium py-2">í™”</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ìˆ˜</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ëª©</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ê¸ˆ</div>
                    <div class="text-xs text-gray-600 font-medium py-2">í† </div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 text-center px-4 gap-y-1"></div>
            </div>

            <!-- ì´ë‹¬ì˜ ì¼ì • ë¦¬ìŠ¤íŠ¸ -->
            <div class="pb-32">
                <h3 class="text-lg font-bold text-main mb-3 px-1 drop-shadow-sm" id="selected-date-title">ì´ë‹¬ì˜ ì¼ì •</h3>
                <div id="event-list" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ í”Œë¡œíŒ… ë©”ë‰´ -->
    <nav id="bottom-nav" class="fixed bottom-3 left-1/2 -translate-x-1/2 z-50 w-auto touch-pan-x select-none">
        <div class="flex items-center bg-white/10 backdrop-blur-[4px] backdrop-saturate-[180%] shadow-[0_8px_32px_0_rgba(31,38,135,0.15)] border border-white/20 rounded-full p-1.5 gap-1 ring-1 ring-white/30">
            <button onclick="goHome()" class="relative px-5 py-2 rounded-full transition-all duration-300 group min-w-[64px]" id="nav-home">
                <div class="absolute inset-0 bg-white/40 shadow-[inset_0_1px_1px_rgba(255,255,255,0.8)] rounded-full backdrop-blur-[2px]" id="nav-home-bg"></div>
                <div class="relative z-10 flex flex-col items-center gap-0.5">
                    <i class="fa-solid fa-house text-base text-[#191F28] drop-shadow-sm"></i>
                    <span class="text-[10px] font-bold text-[#191F28] drop-shadow-sm">í™ˆ</span>
                </div>
            </button>
            <button onclick="goSchedule()" class="relative px-5 py-2 rounded-full transition-all duration-300 group min-w-[64px] hover:bg-white/10" id="nav-calendar">
                <div class="absolute inset-0 bg-white/40 shadow-[inset_0_1px_1px_rgba(255,255,255,0.8)] rounded-full backdrop-blur-[2px] hidden" id="nav-calendar-bg"></div>
                <div class="relative z-10 flex flex-col items-center gap-0.5">
                    <i class="fa-regular fa-calendar-days text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm">ì¼ì •</span>
                </div>
            </button>
            <button onclick="goMeeting()" class="relative px-5 py-2 rounded-full transition-all duration-300 group min-w-[64px] hover:bg-white/10" id="nav-meeting">
                <div class="relative z-10 flex flex-col items-center gap-0.5">
                    <i class="fa-solid fa-users text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm">ëª¨ì„í†µì¥</span>
                </div>
            </button>
        </div>
    </nav>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div id="startup-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center relative overflow-hidden">
            <h3 class="text-xl font-bold text-main mb-3 mt-2">ë°˜ê°€ì›Œìš”! ğŸ‘‹</h3>
            <p class="text-[#4E5968] text-sm mb-8 leading-relaxed">
                ì´ì œ í™ˆ í™”ë©´ì—ì„œ <span class="text-blue-500 font-bold">ì‹¤ì‹œê°„ ì£¼ê°€</span>ë¥¼<br>í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
            </p>
            <div class="flex gap-3">
                <button onclick="closeModal('startup-modal')" class="flex-1 bg-[#F2F4F6] text-[#4E5968] font-bold py-3.5 rounded-xl hover:bg-gray-200 transition-colors">ë‚˜ì¤‘ì—</button>
                <button onclick="closeModal('startup-modal')" class="flex-1 bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20">í™•ì¸í–ˆì–´ìš”</button>
            </div>
        </div>
    </div>

    <div id="common-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center">
            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-500 text-xl" id="modal-icon-bg"><i id="modal-icon" class=""></i></div>
            <h3 class="text-lg font-bold text-main mb-2" id="modal-title">ì œëª©</h3>
            <p class="text-[#4E5968] text-sm mb-6 leading-relaxed break-keep" id="modal-desc">ë‚´ìš©</p>
            <button onclick="closeModal('common-modal')" class="w-full bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20">í™•ì¸</button>
        </div>
    </div>

    <!-- Firebase (ì›ë³¸ ì„¤ì • ìœ ì§€) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyABn9xi7a-3LyLpvS6HT03gJUGTlQkgHmk",
            authDomain: "enjoystock.firebaseapp.com",
            projectId: "enjoystock",
            storageBucket: "enjoystock.firebasestorage.app",
            messagingSenderId: "981969177924",
            appId: "1:981969177924:web:51b0093a0d1b001ead9b11"
        };

        const DATA_PATH = ['artifacts', 'enjoy-stock-live', 'public', 'data', 'stock_data', 'enjoy_ticker'];
        const priceEl = document.getElementById('ticker-price');
        const changeEl = document.getElementById('ticker-change');
        const polyline = document.getElementById('chart-line');
        const pathFill = document.getElementById('chart-fill');
        const svg = document.getElementById('mini-chart');
        const marketBadge = document.getElementById('market-badge');
        const MARKET_START = 8 * 60; const MARKET_END = 23 * 60 + 30;

        function checkMarketStatus(manualPause) {
            const now = new Date();
            const curr = now.getHours() * 60 + now.getMinutes();
            const isOpen = (curr >= MARKET_START && curr < MARKET_END) && !manualPause;
            if (!isOpen) { 
                if(marketBadge) { marketBadge.classList.remove('hidden'); marketBadge.innerText = manualPause ? "ì¼ì‹œì •ì§€" : "ë§ˆê°"; }
            } else { 
                if(marketBadge) marketBadge.classList.add('hidden'); 
            }
        }

        function drawChart(history, basePrice) {
            if (!svg || !history || history.length === 0) return;
            const w = svg.clientWidth || 64;
            const h = svg.clientHeight || 32;
            let min = Math.min(...history, basePrice);
            let max = Math.max(...history, basePrice);
            const pad = (max - min) * 0.1 || 10;
            min -= pad; max += pad;
            const range = max - min;
            const pts = history.map((val, i) => {
                const x = (i / (history.length - 1)) * w;
                const y = h - ((val - min) / range) * h;
                return `${x},${y}`;
            }).join(' ');
            polyline.setAttribute('points', pts);
            pathFill.setAttribute('d', `M ${pts} L ${w},${h} L 0,${h} Z`);
        }

        function updateUI(data) {
            if (!data) return;
            const { currentPrice, basePrice, history, manualPause } = data;
            const base = basePrice || 12000;
            checkMarketStatus(manualPause);
            if(priceEl) priceEl.innerText = currentPrice.toLocaleString() + "ì›";
            const diff = currentPrice - base;
            const rate = ((diff / base) * 100).toFixed(1);
            const sign = diff > 0 ? '+' : '';
            const redColor = '#F04452';
            const blueColor = '#3182F6';
            if (diff > 0) {
                if(priceEl) priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-red-500 price-up`;
                if(changeEl) { changeEl.className = "text-sm font-bold tabular-nums text-red-500 mb-0.5"; changeEl.innerText = `${sign}${rate}%`; }
                if(polyline) polyline.setAttribute('stroke', redColor);
                if(svg) {
                    svg.querySelector('stop:first-child').setAttribute('stop-color', redColor);
                    svg.querySelector('stop:last-child').setAttribute('stop-color', redColor);
                }
            } else if (diff < 0) {
                if(priceEl) priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-blue-500 price-down`;
                if(changeEl) { changeEl.className = "text-sm font-bold tabular-nums text-blue-500 mb-0.5"; changeEl.innerText = `${rate}%`; }
                if(polyline) polyline.setAttribute('stroke', blueColor);
                if(svg) {
                    svg.querySelector('stop:first-child').setAttribute('stop-color', blueColor);
                    svg.querySelector('stop:last-child').setAttribute('stop-color', blueColor);
                }
            } else {
                if(changeEl) { changeEl.className = "text-sm font-bold tabular-nums text-gray-400 mb-0.5"; changeEl.innerText = "0.0%"; }
                if(polyline) polyline.setAttribute('stroke', '#B0B8C1');
            }
            if (history) drawChart(history, base);
        }

        async function init() {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                await signInAnonymously(auth).catch((e) => console.warn("Auth failed", e));
                onSnapshot(doc(db, ...DATA_PATH), (docSnap) => {
                    if (docSnap.exists()) updateUI(docSnap.data());
                }, (error) => console.log("Data sync error:", error));
            } catch(e) { console.error(e); }
        }
        init();
    </script>

    <!-- General Script -->
    <script>
        const LINKS = {
            music: "https://won429.github.io/enjoy/",
            stock: "https://won429.github.io/enjoystock/",
            game: "https://won429.github.io/enjoygame/"
        };

        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth() + 1;
        
        function getMockEvents(year, month) {
            const events = {};
            const keyPrefix = `${year}-${String(month).padStart(2, '0')}`;
            
            // 1. [ì£¼ê¸°ë³„] ë§¤ì›” 6ì¼: íšŒë¹„ ë‚©ë¶€
            const duesDay = '06';
            events[`${keyPrefix}-${duesDay}`] = (events[`${keyPrefix}-${duesDay}`] || []).concat([
                { type: 'dues', title: 'íšŒë¹„ ë‚©ë¶€ì¼ ğŸ’°', time: '15,000ì›' }
            ]);

            // 2. [ì£¼ê¸°ë³„] ìƒì¼ ëª©ë¡
            const birthdays = {
                '01-02': 'ì „ì‹œê¸° ìƒì¼ ğŸ‚',
                '03-22': 'ì§€ë…¸ ìƒì¼ ğŸ‚',
                '04-01': 'ì˜¤ìŠ¤í‹´ ìƒì¼ ğŸ‚',
                '06-05': 'í™ë°•ì‚¬ ìƒì¼ ğŸ‚',
                '06-12': 'ë¥˜ì§± ìƒì¼ ğŸ‚',
                '10-15': 'ì„±ì›ì œ ìƒì¼ ğŸ‚'
            };
            Object.entries(birthdays).forEach(([dateStr, title]) => {
                const [bMonth, bDay] = dateStr.split('-');
                if (parseInt(bMonth) === month) {
                     const key = `${keyPrefix}-${bDay}`;
                     events[key] = (events[key] || []).concat([{ type: 'bday', title: title, time: 'í•˜ë£¨ ì¢…ì¼' }]);
                }
            });

            // 3. [ì£¼ê¸°ë³„] 6ì›” ì „ì²´: ì—”ì¡°ì´ Nì£¼ë…„ì˜ ë‹¬
            if (month === 6) {
                const anniversary = year - 2024;
                let title = `ì—”ì¡°ì´ ${anniversary}ì£¼ë…„ì˜ ë‹¬ ğŸ‰`;
                if (anniversary <= 0) title = "ì—”ì¡°ì´ ì°½ë¦½ì˜ ë‹¬ ğŸ‰"; 

                const lastDay = new Date(year, month, 0).getDate(); 
                for(let i=1; i<=lastDay; i++) {
                    const dayKey = `${keyPrefix}-${String(i).padStart(2, '0')}`;
                    const existing = events[dayKey] || [];
                    events[dayKey] = existing.concat([{ type: 'anniv', title: title, time: 'í•˜ë£¨ ì¢…ì¼' }]);
                }
            }

            // 4. [1íšŒì„±] ì¢…ê°• ì¼ì • (2025ë…„ 12ì›”)
            if (year === 2025 && month === 12) {
                let key = `${keyPrefix}-12`;
                events[key] = (events[key] || []).concat([{ type: 'school', title: 'ìš°ì†¡ëŒ€(ì „ì‹œê¸°) ì¢…ê°• ğŸ«', time: 'ì¼ì •' }]);
                key = `${keyPrefix}-20`;
                events[key] = (events[key] || []).concat([{ type: 'school', title: 'ì•ˆë™ëŒ€(ì„±ì›ì œ) ì¢…ê°• ğŸ«', time: 'ì¼ì •' }]);
            }

            // 5. [1íšŒì„±] ìƒí›ˆì´ ê°œì¸ ì¼ì • (2025-12-23 ~ 2026-01-23)
            const lastDay = new Date(year, month, 0).getDate();
            for(let i=1; i<=lastDay; i++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const currentDate = new Date(dateStr);
                const sanghoonStart = new Date('2025-12-23');
                const sanghoonEnd = new Date('2026-01-23');
                
                if (currentDate >= sanghoonStart && currentDate <= sanghoonEnd) {
                    const existing = events[dateStr] || [];
                    events[dateStr] = existing.concat([{ type: 'personal', title: 'ìƒí›ˆì´ ê°œì¸ ì¼ì • ğŸ ', time: 'í•˜ë£¨ ì¢…ì¼' }]);
                }
            }

            // 6. [1íšŒì„±] ì—¬í–‰ ì¼ì •
            if (year === 2025 && month === 2) {
                ['05', '06', '07'].forEach(day => {
                    const key = `${keyPrefix}-${day}`;
                    events[key] = (events[key] || []).concat([{ type: 'meet', title: 'ê²½ë¶ì¹ ê³¡, ëŒ€êµ¬ ì—¬í–‰ ğŸš…', time: 'ì •ê¸° ëª¨ì„' }]);
                });
            }
            if (year === 2025 && month === 8) {
                ['29', '30'].forEach(day => {
                    const key = `${keyPrefix}-${day}`;
                    events[key] = (events[key] || []).concat([{ type: 'meet', title: 'ì§„ì£¼ ì—¬í–‰ ğŸ°', time: 'ì •ê¸° ëª¨ì„' }]);
                });
            }

            return events;
        }

        let viewYear = today.getFullYear();
        let viewMonth = today.getMonth(); // 0-based
        let activeTabIndex = 0; 
        
        function updateTabUI(index) {
            const homeBg = document.getElementById('nav-home-bg');
            const calBg = document.getElementById('nav-calendar-bg');
            const homeScreen = document.getElementById('home-screen');
            const scheduleScreen = document.getElementById('schedule-screen');
            
            // í•˜ë‹¨ íƒ­ UI ë³€ê²½
            homeBg.classList.add('hidden');
            calBg.classList.add('hidden');
            if (index === 0) homeBg.classList.remove('hidden');
            if (index === 1) calBg.classList.remove('hidden');
            
            // í™”ë©´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ê°œì„ 
            // 0: Home, 1: Schedule
            if (index === 1) {
                // í™ˆ -> ì¼ì • (í™ˆì€ ë’¤ë¡œ ë¹ ì§€ê³ , ì¼ì •ì€ ì˜¤ë¥¸ìª½ì—ì„œ ë“±ì¥)
                homeScreen.classList.add('home-scaled-down');
                
                // ì¼ì • í™”ë©´ ë“±ì¥ (display:flexëŠ” í•­ìƒ ìœ ì§€í•˜ë˜ translateë¡œ ì œì–´)
                // ì²˜ìŒ ë¡œë“œ ì‹œ hiddenì´ì—ˆë‹¤ë©´ ì œê±° í•„ìš”
                scheduleScreen.classList.remove('hidden');
                scheduleScreen.classList.add('flex');
                
                // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ìŠ¬ë¼ì´ë“œ (transition ì ìš© ìœ„í•´)
                requestAnimationFrame(() => {
                    scheduleScreen.classList.remove('translate-x-full');
                });
                
                renderCalendar(viewYear, viewMonth);
            } else {
                // ì¼ì • -> í™ˆ (í™ˆì€ ì›ë˜ëŒ€ë¡œ, ì¼ì •ì€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í‡´ì¥)
                homeScreen.classList.remove('home-scaled-down');
                
                scheduleScreen.classList.add('translate-x-full');
                
                // ì• ë‹ˆë©”ì´ì…˜ ëë‚œ í›„ display none ì²˜ë¦¬ (ì„ íƒì‚¬í•­, ì—¬ê¸°ì„  ìœ ì§€)
            }
        }

        function goHome() { activeTabIndex = 0; updateTabUI(0); }
        function goSchedule() { activeTabIndex = 1; updateTabUI(1); }
        function goMeeting() { alert('ëª¨ì„í†µì¥ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì´ì—ìš”! ğŸ’°'); }

        function changeMonth(delta) {
            viewMonth += delta;
            if (viewMonth < 0) { viewYear--; viewMonth = 11; } 
            else if (viewMonth > 11) { viewYear++; viewMonth = 0; }
            renderCalendar(viewYear, viewMonth);
        }

        function renderCalendar(year, month) {
            const grid = document.getElementById('calendar-grid');
            const title = document.getElementById('cal-title');
            const eventList = document.getElementById('event-list');
            
            title.innerText = `${year}.${String(month + 1).padStart(2, '0')}`;
            grid.innerHTML = '';
            eventList.innerHTML = '';

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const events = getMockEvents(year, month + 1);

            for (let i = 0; i < firstDay; i++) { grid.innerHTML += `<div></div>`; }

            let hasEvents = false;
            let shownMonthlyEvent = false;
            let shownPersonalEvent = false;

            for (let i = 1; i <= lastDate; i++) {
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const dayEvents = events[dateKey];
                const isToday = i === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                
                let dotHtml = '';
                if (dayEvents) {
                    hasEvents = true;
                    dayEvents.forEach(evt => {
                        let color = 'bg-blue-500';
                        if (evt.type === 'anniv') color = 'bg-red-500';
                        else if (evt.type === 'bday') color = 'bg-orange-400';
                        else if (evt.type === 'dues') color = 'bg-emerald-500';
                        else if (evt.type === 'school') color = 'bg-purple-500';
                        else if (evt.type === 'personal') color = 'bg-gray-400';
                        dotHtml += `<div class="w-1.5 h-1.5 rounded-full ${color}"></div>`;
                    });
                }

                const dayEl = document.createElement('div');
                // ë‹¬ë ¥ ë‚ ì§œ ì¹¸ì€ ë„ˆë¬´ íˆ¬ëª…í•˜ë©´ ì•ˆë³´ì´ë¯€ë¡œ ì‚´ì§ë§Œ íˆ¬ëª…í•˜ê²Œ
                dayEl.className = "h-14 flex flex-col items-center justify-start pt-1 cursor-pointer rounded-xl hover:bg-white/20 transition-colors relative";
                if(isToday) dayEl.classList.add('bg-white/50', 'font-bold', 'text-blue-600', 'shadow-sm');
                
                dayEl.innerHTML = `
                    <span class="text-sm ${isToday ? 'text-blue-600' : 'text-gray-700'}">${i}</span>
                    <div class="flex gap-0.5 mt-1 flex-wrap justify-center px-1">${dotHtml}</div>
                `;
                grid.appendChild(dayEl);

                if (dayEvents) {
                    dayEvents.forEach(evt => {
                        // 1. ì—”ì¡°ì´ ì£¼ë…„
                        if (evt.type === 'anniv' && month === 5) {
                            if (!shownMonthlyEvent) {
                                eventList.innerHTML = `
                                    <div class="glass-card p-5 flex items-center gap-4 mb-2 animate-[fadeInUp_0.3s_ease-out]">
                                        <div class="w-12 h-12 rounded-full bg-white/70 flex items-center justify-center text-2xl shrink-0 shadow-sm text-red-500">
                                            <i class="fa-solid fa-cake-candles"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-red-500/80 mb-0.5 font-bold">6ì›” 1ì¼ ~ 6ì›” 30ì¼</p>
                                            <p class="text-lg font-bold text-red-600">${evt.title}</p>
                                            <p class="text-xs text-red-500/80 mt-1">í•œ ë‹¬ ë‚´ë‚´ ì¶•í•˜í•´ìš”!</p>
                                        </div>
                                    </div>
                                ` + eventList.innerHTML;
                                shownMonthlyEvent = true;
                            }
                        } 
                        // 2. ìƒí›ˆì´ ê°œì¸ ì¼ì •
                        else if (evt.type === 'personal') {
                            if (!shownPersonalEvent) {
                                eventList.innerHTML += `
                                    <div class="glass-card p-5 flex items-center gap-4 animate-[fadeInUp_0.3s_ease-out]">
                                        <div class="w-12 h-12 rounded-full bg-white/70 flex items-center justify-center text-xl shrink-0 shadow-sm text-gray-500">
                                            <i class="fa-solid fa-house-user"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 mb-0.5 font-bold">25.12.23 ~ 26.01.23</p>
                                            <p class="text-base font-bold text-gray-800">${evt.title}</p>
                                            <p class="text-xs text-gray-500 mt-0.5">ì¥ê¸° ì¼ì •ì…ë‹ˆë‹¤</p>
                                        </div>
                                    </div>
                                `;
                                shownPersonalEvent = true;
                            }
                        }
                        // 3. ë‚˜ë¨¸ì§€ ì¼ì • (ì¹´ë“œë„ glass-card í´ë˜ìŠ¤ ì‚¬ìš©)
                        else {
                            let icon = 'fa-suitcase-rolling text-blue-500';
                            let bgColor = 'bg-blue-50';
                            let textColor = 'text-gray-800';
                            
                            if (evt.type === 'bday') { icon = 'fa-gift text-orange-500'; bgColor = 'bg-orange-100'; } 
                            else if (evt.type === 'dues') { icon = 'fa-coins text-emerald-500'; bgColor = 'bg-emerald-100'; } 
                            else if (evt.type === 'school') { icon = 'fa-school text-purple-500'; bgColor = 'bg-purple-100'; }
                            else { bgColor = 'bg-blue-100'; } // ê¸°ë³¸

                            const dateStr = `${month + 1}ì›” ${i}ì¼`;
                            eventList.innerHTML += `
                                <div class="glass-card p-5 flex items-center gap-4 animate-[fadeInUp_0.3s_ease-out]">
                                    <div class="w-12 h-12 rounded-full ${bgColor} bg-opacity-80 flex items-center justify-center text-xl shrink-0 shadow-sm">
                                        <i class="fa-solid ${icon}"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-0.5 font-bold">${dateStr} Â· ${evt.time}</p>
                                        <p class="text-base font-bold ${textColor}">${evt.title}</p>
                                    </div>
                                </div>
                            `;
                        }
                    });
                }
            }
            if (!hasEvents) {
                eventList.innerHTML = `<div class="text-center py-10 text-gray-400"><i class="fa-regular fa-calendar-xmark text-4xl mb-3 opacity-50"></i><p class="text-sm">ì´ë‹¬ì˜ ì¼ì •ì´ ì—†ì–´ìš”</p></div>`;
            }
        }
        
        renderCalendar(viewYear, viewMonth);
        function closeModal(id) { const modal = document.getElementById(id); modal.classList.add('hidden'); modal.classList.remove('flex'); }
        function showModal(id, title, desc, iconClass, iconColorClass) {
            const modal = document.getElementById(id);
            if(title) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-desc').innerHTML = desc;
                const iconBg = document.getElementById('modal-icon-bg');
                const icon = document.getElementById('modal-icon');
                icon.className = iconClass;
                if(iconColorClass) iconBg.className = `w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl ${iconColorClass}`;
                else iconBg.className = "w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-500 text-xl";
            }
            modal.classList.remove('hidden'); modal.classList.add('flex');
        }
        function goToMusic() { if (LINKS.music) window.location.href = LINKS.music; }
        function checkStock() { if (LINKS.stock) window.location.href = LINKS.stock; }
        function playGame() { if (LINKS.game) window.location.href = LINKS.game; }
        function showTravelModal() { showModal('common-modal', 'Coming Soon', 'ì—¬í–‰ ê¸°ë¡ ì„œë¹„ìŠ¤ëŠ”<br>í˜„ì¬ ì¤€ë¹„ ì¤‘ì´ì—ìš” âœˆï¸', 'fa-solid fa-plane', 'bg-emerald-50 text-emerald-500'); }
        function showSecretModal() { showModal('common-modal', 'ë‹¤ìŒ ì„œë¹„ìŠ¤ëŠ”?', 'ì–´ë–¤ ê¸°ëŠ¥ì´ ì¶”ê°€ë ê¹Œìš”?<br>ê¸°ëŒ€í•´ ì£¼ì„¸ìš”! ğŸ', 'fa-solid fa-lock', 'bg-gray-100 text-gray-400'); }
        function setGreeting() {
            const hour = new Date().getHours();
            const msgEl = document.getElementById('time-msg');
            const emojiEl = document.getElementById('bg-emoji');
            let msg = '', emoji = '';
            if (hour >= 5 && hour < 12) { msg = 'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! ìƒì¾Œí•œ í•˜ë£¨ ì‹œì‘í•˜ì„¸ìš”'; emoji = 'â˜€ï¸'; }
            else if (hour >= 12 && hour < 14) { msg = 'ë§›ìˆëŠ” ì ì‹¬ ë“œì…¨ë‚˜ìš”? ì˜¤í›„ë„ íŒŒì´íŒ…!'; emoji = 'ğŸ±'; }
            else if (hour >= 14 && hour < 18) { msg = 'ë‚˜ë¥¸í•œ ì˜¤í›„ë„¤ìš”, ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”!'; emoji = 'â˜•ï¸'; }
            else if (hour >= 18 && hour < 22) { msg = 'ì˜¤ëŠ˜ í•˜ë£¨ ê³ ìƒí•˜ì…¨ì–´ìš”. í¸ì•ˆí•œ ì €ë… ë˜ì„¸ìš”'; emoji = 'ğŸŒ™'; }
            else { msg = 'ë°¤ì´ ê¹Šì—ˆì–´ìš”. ì¢‹ì€ ê¿ˆ ê¾¸ì„¸ìš”'; emoji = 'âœ¨'; }
            msgEl.innerHTML = msg; emojiEl.innerHTML = emoji;
        }
        window.addEventListener('DOMContentLoaded', () => {
            setGreeting(); 
            setTimeout(() => { const startModal = document.getElementById('startup-modal'); startModal.classList.remove('hidden'); startModal.classList.add('flex'); }, 500);
            const nav = document.getElementById('bottom-nav');
            let startX = 0; let startY = 0;
            nav.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, {passive: true});
            nav.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[0].clientX; const endY = e.changedTouches[0].clientY;
                const diffX = endX - startX; const diffY = endY - startY;
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 30) {
                    if (diffX > 0) { if (activeTabIndex === 1) goHome(); else if (activeTabIndex === 2) goSchedule(); } 
                    else { if (activeTabIndex === 0) goSchedule(); else if (activeTabIndex === 1) goMeeting(); }
                }
            });
        });
    </script>
</body>
</html>