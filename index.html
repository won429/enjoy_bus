<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy - Toss Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face {
            font-family: 'TossFaceFontMac';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface-font-mac.css');
        }

        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            background-color: #F2F4F6;
            color: #191F28;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            touch-action: pan-y;
        }

        /* ìœ ë¦¬ ì¬ì§ˆ ê³µí†µ í´ë˜ìŠ¤ */
        .toss-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04); 
            transition: transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.1s;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        .toss-card:active {
            transform: scale(0.96);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.02);
        }

        /* ì¼ì •/ëª¨ì„ í™”ë©´ìš© ìœ ë¦¬ ì¹´ë“œ */
        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border-radius: 24px;
        }

        /* ë¯¸ë‚©ììš© íŒŒìŠ¤í…” ë ˆë“œ ë¸”ë¡ */
        .glass-card-unpaid {
            background: rgba(254, 226, 226, 0.6);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(254, 202, 202, 0.6);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.05);
            border-radius: 24px;
        }

        .text-main { color: #191F28; }
        .text-sub { color: #6B7684; }
        .text-blue { color: #3182F6; }
        .text-red { color: #F04452; }

        .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe-area { padding-bottom: env(safe-area-inset-bottom); } 
        
        .price-up { color: #F04452 !important; transition: color 0.3s; }
        .price-down { color: #3182F6 !important; transition: color 0.3s; }

        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .bg-emoji {
            animation: floatEmoji 6s ease-in-out infinite;
            filter: blur(0px); 
            position: absolute;
            right: 0;
            bottom: -10px;
            z-index: 0;
        }

        /* í•˜ë‹¨ ë©”ë‰´ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ */
        #nav-indicator {
            will-change: transform, width;
        }
        .nav-transition {
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), width 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="w-full h-[100dvh] flex flex-col overflow-hidden bg-gradient-to-br from-[#F2F4F6] via-[#E8ECF2] to-[#DEE2E6]">

    <!-- ë©”ì¸ ì»¨í…ì¸  (í™ˆ í™”ë©´) -->
    <main id="home-screen" class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-safe pb-24 w-full max-w-md mx-auto relative min-h-full">
        
        <!-- ğŸ‘‹ ìƒë‹¨ ì¸ì‚¬ë§ -->
        <div class="mb-6 mt-4 fade-in-up relative h-24 flex flex-col justify-center overflow-visible">
            <div id="bg-emoji" class="bg-emoji text-[80px] opacity-20 select-none pointer-events-none transform translate-x-2"></div>
            <div class="relative z-10">
                <h1 class="text-2xl font-bold text-main leading-tight mb-1">ì—”ì¡°ì´ ì—¬ëŸ¬ë¶„,</h1>
                <p id="time-msg" class="text-2xl font-bold text-main leading-tight opacity-90">ì•ˆë…•í•˜ì„¸ìš”!</p>
            </div>
        </div>

        <!-- ì„¹ì…˜ 1: ìì‚°/ì£¼ì‹ -->
        <div class="toss-card p-6 mb-4 fade-in-up delay-100 group" onclick="window.haptic(); window.checkStock()">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-main">ì—”ì¡°ì´ ì¦ê¶Œ</h2>
                <i class="fa-solid fa-chevron-right text-sub text-xs group-hover:translate-x-1 transition-transform"></i>
            </div>
            
            <div class="flex items-center justify-between relative z-10 pb-2">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-blue-50/80 flex items-center justify-center text-blue-500 text-xl shadow-sm">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <p class="text-sm font-medium text-sub">ì—”ì¡°ì´</p> 
                            <span id="market-badge" class="hidden text-[10px] font-bold bg-gray-100/80 text-gray-500 px-1.5 py-0.5 rounded-md">ë§ˆê°</span>
                        </div>
                        <div class="flex items-end gap-2">
                            <h3 id="ticker-price" class="text-2xl font-bold text-main tabular-nums tracking-tight">Loading...</h3>
                            <span id="ticker-change" class="text-sm font-medium text-sub mb-1 tabular-nums">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë°°ê²½ ì°¨íŠ¸ -->
            <div class="absolute bottom-0 right-0 w-[60%] h-[50%] opacity-20 pointer-events-none">
                 <svg id="mini-chart" width="100%" height="100%" preserveAspectRatio="none" class="overflow-visible">
                    <defs>
                        <linearGradient id="chart-grad" x1="0" x2="0" y1="0" y2="1">
                            <stop offset="0%" stop-color="#3182F6" stop-opacity="0.5"/>
                            <stop offset="100%" stop-color="#3182F6" stop-opacity="0"/>
                        </linearGradient>
                    </defs>
                    <path id="chart-fill" d="" fill="url(#chart-grad)"></path>
                    <polyline id="chart-line" points="" fill="none" stroke="#3182F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline>
                 </svg>
            </div>
        </div>

        <!-- ì„¹ì…˜ 2: ì—”ì¡°ì´ ì„œë¹„ìŠ¤ -->
        <h3 class="text-lg font-bold text-main mb-3 px-1 fade-in-up delay-200">ì—”ì¡°ì´ ì„œë¹„ìŠ¤</h3>
        
        <!-- 1. ë©”ì¸ ì„œë¹„ìŠ¤ (ìŒì•…) -->
        <div class="mb-3 fade-in-up delay-200">
            <button onclick="window.haptic(); window.goToMusic()" class="toss-card w-full p-6 flex flex-row-reverse items-center justify-between group overflow-hidden relative h-32 !bg-[#E8F3FF]/60 backdrop-blur-md border border-white/60">
                <div class="relative z-10 w-16 h-16 rounded-full bg-white/70 backdrop-blur-sm shadow-sm flex items-center justify-center text-blue-500 text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="fa-solid fa-headphones"></i>
                </div>
                <div class="relative z-10 text-left flex-1 pr-4">
                    <div class="flex items-center gap-1.5 mb-1.5">
                        <span class="text-[10px] font-bold text-blue-500 bg-white/70 px-1.5 py-0.5 rounded-md">TODAY</span>
                        <span class="w-1 h-1 rounded-full bg-blue-500"></span>
                        <span class="text-[10px] font-medium text-blue-400">ìŒì•…</span>
                    </div>
                    <h4 class="text-xl font-bold text-main leading-tight mb-1">ì—”ì¡°ì´ ë¸Œì´ë¡œê·¸ ì†<br>ìŒì•… ë“£ê¸°</h4>
                </div>
            </button>
        </div>

        <!-- 2. ì„œë¸Œ ì„œë¹„ìŠ¤ (ê²Œì„, ì—¬í–‰) -->
        <div class="grid grid-cols-2 gap-3 mb-3 fade-in-up delay-200">
            <!-- ê²Œì„ -->
            <button onclick="window.haptic(); window.playGame()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group !bg-[#FFF0F0]/60 backdrop-blur-md border border-white/60 hover:!bg-[#FFE5E5]/70 transition-colors">
                <div class="w-full flex justify-between items-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 backdrop-blur-sm flex items-center justify-center text-[#FF6B6B] text-xl group-hover:rotate-12 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-dice"></i>
                    </div>
                    <span class="bg-[#FF6B6B] text-white text-[9px] font-bold px-1.5 py-0.5 rounded-md tracking-tight">NEW</span>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-main mb-1">ì—”ì¡°ì´ ë³µë¶ˆë³µ</h4>
                    <p class="text-xs text-[#FF6B6B]/90 font-medium leading-snug">ì—”ì¡°ì´ì˜<br>ìš´ëª…ì€?</p>
                </div>
            </button>

            <!-- ì—¬í–‰ -->
            <button onclick="window.haptic(); window.showTravelModal()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group !bg-[#E3FAEB]/60 backdrop-blur-md border border-white/60 hover:!bg-[#D1F7DE]/70 transition-colors">
                <div class="w-full flex justify-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 backdrop-blur-sm flex items-center justify-center text-[#00C77D] text-xl group-hover:scale-110 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-plane-departure"></i>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-main mb-1">ì—¬í–‰ ê¸°ë¡</h4>
                    <p class="text-xs text-[#00C77D]/90 font-medium leading-snug">ì§€ë‚œ ì¶”ì–µì„<br>ë– ì˜¬ë ¤ë´ìš”</p>
                </div>
            </button>
        </div>

        <!-- 3. ê¸°íƒ€ (ì¤€ë¹„ ì¤‘) -->
        <div class="mb-6 fade-in-up delay-200">
            <button onclick="window.haptic(); window.showSecretModal()" class="toss-card w-full p-5 flex items-center justify-between group !bg-white/40 backdrop-blur-md border border-white/60 hover:!bg-white/60 transition-all">
                <div class="flex items-center gap-4">
                    <div class="w-11 h-11 rounded-[18px] bg-gray-100/80 backdrop-blur-sm flex items-center justify-center text-gray-400 text-lg shadow-sm group-hover:scale-110 group-hover:text-blue-400 group-hover:bg-blue-50 transition-all duration-300">
                        <i class="fa-solid fa-gift"></i>
                    </div>
                    <div class="text-left">
                        <p class="text-base font-bold text-main leading-tight">ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘</p>
                        <p class="text-xs text-sub mt-1">ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ì¶”ê°€ë ê¹Œìš”?</p>
                    </div>
                </div>
                <div class="w-8 h-8 rounded-full flex items-center justify-center text-gray-300 group-hover:text-gray-500 group-hover:bg-white/50 transition-all">
                    <i class="fa-solid fa-chevron-right text-xs"></i>
                </div>
            </button>
        </div>

        <div class="mt-8 text-center pb-8">
            <button class="text-xs text-sub underline hover:text-gray-600" onclick="window.haptic()">í™”ë©´ í¸ì§‘í•˜ê¸°</button>
            <p class="text-[10px] text-gray-400 mt-4">Â© 2024 Enjoy Corp.</p>
        </div>
    </main>

    <!-- ğŸ“… ì¼ì • í™”ë©´ -->
    <div id="schedule-screen" class="hidden fixed top-0 bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md z-30 flex-col overflow-hidden bg-gradient-to-br from-[#F2F4F6] via-[#E8ECF2] to-[#DEE2E6]">
        <header class="flex-none pt-safe px-6 pb-4 flex justify-between items-center bg-white/30 backdrop-blur-md border-b border-white/20 z-10 sticky top-0">
            <h2 class="text-2xl font-bold text-main drop-shadow-sm">ì¼ì •</h2>
            <div class="flex gap-2">
                <button onclick="window.haptic(); window.changeMonth(-1)" class="w-8 h-8 rounded-full bg-white/40 hover:bg-white/60 backdrop-blur-sm flex items-center justify-center text-gray-700 shadow-sm transition-colors"><i class="fa-solid fa-chevron-left"></i></button>
                <span id="cal-title" class="text-lg font-bold text-main tabular-nums flex items-center drop-shadow-sm">2024.05</span>
                <button onclick="window.haptic(); window.changeMonth(1)" class="w-8 h-8 rounded-full bg-white/40 hover:bg-white/60 backdrop-blur-sm flex items-center justify-center text-gray-700 shadow-sm transition-colors"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto scrollbar-hide px-4 pt-4 w-full max-w-md mx-auto">
            <div class="bg-white/40 backdrop-blur-md border border-white/40 rounded-[32px] shadow-lg mb-6 pb-6 ring-1 ring-white/30">
                <div class="grid grid-cols-7 text-center mb-2 px-4 pt-4">
                    <div class="text-xs text-red-500 font-bold py-2">ì¼</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ì›”</div>
                    <div class="text-xs text-gray-600 font-medium py-2">í™”</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ìˆ˜</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ëª©</div>
                    <div class="text-xs text-gray-600 font-medium py-2">ê¸ˆ</div>
                    <div class="text-xs text-gray-600 font-medium py-2">í† </div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 text-center px-4 gap-y-1"></div>
            </div>

            <div class="pb-24"> 
                <div class="flex justify-between items-end mb-3 px-1">
                    <h3 class="text-lg font-bold text-main drop-shadow-sm" id="selected-date-title">ì´ë‹¬ì˜ ì¼ì •</h3>
                    <button onclick="window.haptic(); window.openAddScheduleModal()" class="flex items-center gap-1 bg-white/60 hover:bg-white/80 text-blue-600 px-3 py-1.5 rounded-full text-xs font-bold transition-colors shadow-sm backdrop-blur-sm cursor-pointer z-20 active:scale-95">
                        <i class="fa-solid fa-plus"></i> ì¶”ê°€
                    </button>
                </div>
                <div id="event-list" class="space-y-3"></div>
                <div class="mt-8 text-center pb-8">
                    <button class="text-xs text-sub underline hover:text-gray-600" onclick="window.haptic()">ì¼ì • ì¶”ê°€ ìš”ì²­í•˜ê¸°</button>
                    <p class="text-[10px] text-gray-400 mt-4">Â© 2024 Enjoy Corp.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’° ëª¨ì„í†µì¥ í™”ë©´ -->
    <div id="meeting-screen" class="hidden fixed top-0 bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md z-30 flex-col overflow-hidden bg-gradient-to-br from-[#F2F4F6] via-[#E8ECF2] to-[#DEE2E6]">
        <header class="flex-none pt-safe px-6 pb-4 flex justify-between items-center bg-white/30 backdrop-blur-md border-b border-white/20 z-10 sticky top-0">
            <h2 class="text-2xl font-bold text-main drop-shadow-sm">ëª¨ì„í†µì¥</h2>
            <button onclick="window.haptic(); window.openPasswordModal()" class="text-sm font-medium text-gray-500 hover:text-gray-800 transition-colors cursor-pointer z-20 p-2">ê´€ë¦¬</button>
        </header>

        <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-4">
            <div class="glass-card p-6 mb-6 relative overflow-hidden group">
                <div class="absolute -right-6 -top-6 w-32 h-32 bg-blue-400/20 rounded-full blur-2xl pointer-events-none"></div>
                <div class="flex justify-between items-start mb-1">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-white/60 flex items-center justify-center text-lg">ğŸ’°</div>
                        <span class="text-sm font-bold text-gray-600">ì—”ì¡°ì´ íšŒë¹„</span>
                    </div>
                </div>
                <div class="mt-8 mb-4">
                    <h3 id="total-balance" class="text-3xl font-bold text-main tabular-nums tracking-tight">448,999ì›</h3>
                </div>
            </div>

            <div class="pb-24">
                <div class="flex justify-between items-center mb-3 px-1">
                    <h3 class="text-lg font-bold text-main drop-shadow-sm">íšŒë¹„ ë‚©ë¶€ í˜„í™©</h3>
                    <div class="flex items-center gap-2 bg-white/40 rounded-full px-2 py-1 backdrop-blur-sm shadow-sm border border-white/30">
                        <button onclick="window.haptic(); window.changeDuesMonth(-1)" class="w-6 h-6 rounded-full hover:bg-white/50 flex items-center justify-center text-gray-600 transition-colors active:scale-90"><i class="fa-solid fa-chevron-left text-xs"></i></button>
                        <span id="dues-month-title" class="text-xs font-bold text-main tabular-nums">12ì›” ê¸°ì¤€</span>
                        <button onclick="window.haptic(); window.changeDuesMonth(1)" class="w-6 h-6 rounded-full hover:bg-white/50 flex items-center justify-center text-gray-600 transition-colors active:scale-90"><i class="fa-solid fa-chevron-right text-xs"></i></button>
                    </div>
                </div>
                <div id="dues-list" class="space-y-3"></div>
                <div class="mt-8 text-center pb-8">
                    <button class="text-xs text-sub underline hover:text-gray-600" onclick="window.haptic()">ë‚´ì—­ ì¡°íšŒ ë¬¸ì œ í•´ê²°</button>
                    <p class="text-[10px] text-gray-400 mt-4">Â© 2024 Enjoy Corp.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ í”Œë¡œíŒ… ë©”ë‰´ -->
    <nav id="bottom-nav" class="fixed bottom-3 left-1/2 -translate-x-1/2 z-50 w-auto touch-pan-x select-none cursor-grab active:cursor-grabbing">
        <div class="flex items-center bg-white/10 backdrop-blur-[4px] backdrop-saturate-[180%] shadow-[0_8px_32px_0_rgba(31,38,135,0.15)] border border-white/20 rounded-full p-1.5 gap-1 ring-1 ring-white/30 relative">
            
            <!-- ìŠ¬ë¼ì´ë”© ì¸ë””ì¼€ì´í„° -->
            <div id="nav-indicator" class="absolute top-1 bottom-1 bg-white/50 shadow-[inset_0_1px_1px_rgba(255,255,255,0.8)] rounded-full backdrop-blur-[2px] border border-white/20 z-0 nav-transition" style="left: 6px; width: 64px;"></div>

            <button id="nav-home" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); window.goHome()">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-house text-base text-[#191F28] drop-shadow-sm"></i>
                    <span class="text-[10px] font-bold text-[#191F28] drop-shadow-sm whitespace-nowrap">í™ˆ</span>
                </div>
            </button>
            <button id="nav-calendar" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); window.goSchedule()">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-regular fa-calendar-days text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm whitespace-nowrap">ì¼ì •</span>
                </div>
            </button>
            <button id="nav-meeting" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); window.goMeeting()">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-users text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm whitespace-nowrap">ëª¨ì„í†µì¥</span>
                </div>
            </button>
        </div>
    </nav>

    <!-- ğŸ”’ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ -->
    <div id="password-modal" class="fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center relative">
            <h3 class="text-lg font-bold text-main mb-4">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
            <input type="password" id="admin-password-input" class="w-full bg-gray-100 border-none rounded-xl px-4 py-3 text-center text-lg mb-4 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬" maxlength="4">
            <div class="flex gap-2">
                <button onclick="window.haptic(); window.closeModal('password-modal')" class="flex-1 bg-gray-100 text-gray-500 font-bold py-3 rounded-xl active:bg-gray-200">ì·¨ì†Œ</button>
                <button onclick="window.haptic(); window.checkPassword()" class="flex-1 bg-blue-500 text-white font-bold py-3 rounded-xl shadow-md hover:bg-blue-600 active:bg-blue-700">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
    <div id="admin-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl scale-in relative overflow-hidden max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-main">íšŒë¹„ ê´€ë¦¬ (<span id="admin-month-title"></span>)</h3>
                <button onclick="window.haptic(); window.closeModal('admin-modal')" class="text-gray-400 hover:text-gray-600 active:scale-90"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="overflow-y-auto flex-1 pr-1">
                <div class="mb-6">
                    <label class="block text-xs text-gray-500 font-bold mb-1">ì´ íšŒë¹„ ì”ì•¡</label>
                    <input type="number" id="admin-total-balance" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 font-bold text-lg text-main focus:outline-none focus:border-blue-500 transition-colors" placeholder="ê¸ˆì•¡ ì…ë ¥">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 font-bold mb-2">ë©¤ë²„ë³„ ë‚©ë¶€ ìƒíƒœ</label>
                    <div id="admin-member-list" class="space-y-2"></div>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-100">
                <button onclick="window.haptic(); window.saveAdminData()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3.5 rounded-xl transition-colors shadow-md active:bg-blue-700">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="schedule-add-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl scale-in relative overflow-hidden flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-main">ì¼ì • ì¶”ê°€</h3>
                <button onclick="window.haptic(); window.closeModal('schedule-add-modal')" class="text-gray-400 hover:text-gray-600 active:scale-90"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-500 font-bold mb-1.5">ì¹´í…Œê³ ë¦¬</label>
                    <select id="add-sch-category" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-main focus:outline-none focus:border-blue-500 transition-colors">
                        <option value="meet">ì •ê¸° ëª¨ì„</option>
                        <option value="personal">ê°œì¸ ì¼ì •</option>
                        <option value="school">í•™êµ/ì¢…ê°•</option>
                        <option value="bday">ìƒì¼</option>
                        <option value="etc">ê¸°íƒ€</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-500 font-bold mb-1.5">ë‚ ì§œ</label>
                    <input type="date" id="add-sch-date" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-main focus:outline-none focus:border-blue-500 transition-colors">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 font-bold mb-1.5">ì‹œê°„</label>
                    <input type="text" id="add-sch-time" placeholder="ì˜ˆ: 19:00, í•˜ë£¨ ì¢…ì¼" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-main focus:outline-none focus:border-blue-500 transition-colors">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 font-bold mb-1.5">ì¼ì • ì´ë¦„</label>
                    <input type="text" id="add-sch-title" placeholder="ì¼ì • ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-main focus:outline-none focus:border-blue-500 transition-colors">
                </div>
            </div>
            <div class="mt-6 pt-2">
                <button onclick="window.haptic(); window.saveScheduleToFirebase()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3.5 rounded-xl transition-colors shadow-md active:bg-blue-700">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ê³µí†µ íŒì—… ëª¨ë‹¬ -->
    <div id="common-modal" class="fixed inset-0 z-[70] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center">
            <div class="w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl" id="modal-icon-bg">
                <i id="modal-icon" class=""></i>
            </div>
            <h3 class="text-lg font-bold text-main mb-2" id="modal-title">ì œëª©</h3>
            <p class="text-[#4E5968] text-sm mb-6 leading-relaxed break-keep" id="modal-desc">ë‚´ìš©</p>
            <button onclick="window.haptic(); window.closeModal('common-modal')" class="w-full bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20 active:scale-95">í™•ì¸</button>
        </div>
    </div>

    <!-- ìŠ¤íƒ€íŠ¸ì—… ëª¨ë‹¬ -->
    <div id="startup-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center relative overflow-hidden">
            <h3 class="text-xl font-bold text-main mb-3 mt-2">ë°˜ê°€ì›Œìš”! ğŸ‘‹</h3>
            <p class="text-[#4E5968] text-sm mb-8 leading-relaxed">ì´ì œ í™ˆ í™”ë©´ì—ì„œ <span class="text-blue-500 font-bold">ì‹¤ì‹œê°„ ì£¼ê°€</span>ë¥¼<br>í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
            <div class="flex gap-3">
                <button onclick="window.haptic(); window.closeModal('startup-modal')" class="flex-1 bg-[#F2F4F6] text-[#4E5968] font-bold py-3.5 rounded-xl hover:bg-gray-200 transition-colors active:scale-95">ë‚˜ì¤‘ì—</button>
                <button onclick="window.haptic(); window.closeModal('startup-modal')" class="flex-1 bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20 active:scale-95">í™•ì¸í–ˆì–´ìš”</button>
            </div>
        </div>
    </div>

    <!-- í†µí•© ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // 1. ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
        window.meetingData = null;
        window.currentDuesMonth = 12;
        window.dynamicEvents = {};
        window.viewYear = new Date().getFullYear();
        window.viewMonth = new Date().getMonth();
        window.activeTabIndex = 0;
        let meetingDb = null;
        
        // ì§„ë™ í•¨ìˆ˜
        window.haptic = function() {
            if (navigator.vibrate) navigator.vibrate(10);
        }

        // --- UI & Logic Functions ---
        
        window.updateTabUI = function(index) {
            window.activeTabIndex = index;
            const homeScreen = document.getElementById('home-screen');
            const scheduleScreen = document.getElementById('schedule-screen');
            const meetingScreen = document.getElementById('meeting-screen');
            
            homeScreen.classList.add('hidden');
            scheduleScreen.classList.add('hidden');
            meetingScreen.classList.add('hidden');
            scheduleScreen.classList.remove('flex'); 
            meetingScreen.classList.remove('flex');

            if (index === 0) {
                homeScreen.classList.remove('hidden');
            } else if (index === 1) {
                scheduleScreen.classList.remove('hidden');
                scheduleScreen.classList.add('flex');
                window.renderCalendar(window.viewYear, window.viewMonth);
            } else if (index === 2) {
                meetingScreen.classList.remove('hidden');
                meetingScreen.classList.add('flex');
                window.renderDues(window.currentDuesMonth);
            }

            const indicator = document.getElementById('nav-indicator');
            const btns = [document.getElementById('nav-home'), document.getElementById('nav-calendar'), document.getElementById('nav-meeting')];
            const currentBtn = btns[index];

            if(currentBtn && indicator) {
                indicator.classList.add('nav-transition'); 
                indicator.style.width = `${currentBtn.offsetWidth}px`;
                indicator.style.transform = `translateX(${currentBtn.offsetLeft - 6}px)`;
            }
        }

        // ë“œë˜ê·¸ ë¡œì§
        const nav = document.getElementById('bottom-nav');
        const indicator = document.getElementById('nav-indicator');
        let isDraggingNav = false;
        
        nav.addEventListener('touchstart', (e) => {
            isDraggingNav = true;
            indicator.classList.remove('nav-transition');
        }, {passive: true});

        nav.addEventListener('touchmove', (e) => {
            if(!isDraggingNav) return;
            const touchX = e.touches[0].clientX;
            const navRect = nav.getBoundingClientRect();
            if(touchX >= navRect.left && touchX <= navRect.right) {
                let relativeX = touchX - navRect.left - 6;
                const maxMove = navRect.width - indicator.offsetWidth - 12;
                if(relativeX < 0) relativeX = 0;
                if(relativeX > maxMove) relativeX = maxMove;
                indicator.style.transform = `translateX(${relativeX}px)`;
            }
        }, {passive: true});

        nav.addEventListener('touchend', (e) => {
            if(!isDraggingNav) return;
            isDraggingNav = false;
            const touchX = e.changedTouches[0].clientX;
            const navRect = nav.getBoundingClientRect();
            const btnWidth = navRect.width / 3;
            let relativeX = touchX - navRect.left;
            let targetIndex = 0;
            if (relativeX < btnWidth) targetIndex = 0;
            else if (relativeX < btnWidth * 2) targetIndex = 1;
            else targetIndex = 2;
            window.updateTabUI(targetIndex);
            window.haptic(); // ë“œë˜ê·¸ ë†“ê³  íƒ­ ì´ë™ ì‹œ ì§„ë™
        });

        // Modal Helpers
        window.closeModal = (id) => { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); };
        
        // íŒì—…ì°½ ê¸°ëŠ¥ ìˆ˜ì •
        window.showTravelModal = () => {
             const modal = document.getElementById('common-modal');
             document.getElementById('modal-title').innerText = 'Coming Soon';
             document.getElementById('modal-desc').innerHTML = 'ì—¬í–‰ ê¸°ë¡ ì„œë¹„ìŠ¤ëŠ”<br>ê³§ ì„œë¹„ìŠ¤ê°€ ë  ì˜ˆì •ì´ì—ìš” âœˆï¸';
             const iconBg = document.getElementById('modal-icon-bg');
             const icon = document.getElementById('modal-icon');
             icon.className = 'fa-solid fa-plane';
             iconBg.className = 'w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl bg-emerald-50 text-emerald-500';
             modal.classList.remove('hidden'); modal.classList.add('flex');
        };
        
        window.showSecretModal = () => {
             const modal = document.getElementById('common-modal');
             document.getElementById('modal-title').innerText = 'ë‹¤ìŒ ì„œë¹„ìŠ¤ëŠ”?';
             document.getElementById('modal-desc').innerHTML = 'ì–´ë–¤ ì„œë¹„ìŠ¤ê°€<br>ìƒˆë¡œ ë‚˜ì˜¬ê¹Œìš”? ğŸ';
             const iconBg = document.getElementById('modal-icon-bg');
             const icon = document.getElementById('modal-icon');
             icon.className = 'fa-solid fa-gift';
             iconBg.className = 'w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl bg-gray-100 text-gray-400';
             modal.classList.remove('hidden'); modal.classList.add('flex');
        };

        window.openPasswordModal = function() { document.getElementById('admin-password-input').value = ''; document.getElementById('password-modal').classList.remove('hidden'); document.getElementById('password-modal').classList.add('flex'); };
        window.checkPassword = function() { const pw = document.getElementById('admin-password-input').value; if (pw === '0920') { window.closeModal('password-modal'); window.openAdminModalReal(); } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); } };
        
        window.openAdminModalReal = function() { 
            if (!window.meetingData) window.meetingData = getInitialMeetingData(); 
            const modal = document.getElementById('admin-modal'); 
            modal.classList.remove('hidden'); modal.classList.add('flex'); 
            document.getElementById('admin-month-title').innerText = `${window.currentDuesMonth}ì›”`; 
            document.getElementById('admin-total-balance').value = window.meetingData.totalBalance || 0; 
            const list = document.getElementById('admin-member-list'); 
            list.innerHTML = ''; 
            if (!window.meetingData.records[window.currentDuesMonth]) window.meetingData.records[window.currentDuesMonth] = createEmptyMonthData(); 
            const records = window.meetingData.records[window.currentDuesMonth]; 
            records.forEach((m, i) => { const isPaid = m.status === 'paid'; list.innerHTML += `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><span class="font-bold text-sm text-main">${m.name}</span><div class="flex items-center gap-2"><input type="number" id="edit-amt-${i}" class="w-20 text-right text-xs p-1 border rounded" value="${m.amount}"><button onclick="window.togglePay(${i})" class="text-xs font-bold px-3 py-1.5 rounded-lg transition-colors ${isPaid ? 'bg-blue-100 text-blue-600' : 'bg-red-100 text-red-600'}">${isPaid ? 'ë‚©ë¶€' : 'ë¯¸ë‚©'}</button></div></div>`; }); 
        };
        
        window.togglePay = function(idx) { const records = window.meetingData.records[window.currentDuesMonth]; if(records && records[idx]) { const m = records[idx]; if(m.status === 'paid') { m.status = 'unpaid'; m.amount = 0; } else { m.status = 'paid'; m.amount = 15000; } const row = document.getElementById('admin-member-list').children[idx]; row.querySelector('input').value = m.amount; const btn = row.querySelector('button'); btn.className = `text-xs font-bold px-3 py-1.5 rounded-lg transition-colors ${m.status === 'paid' ? 'bg-blue-100 text-blue-600' : 'bg-red-100 text-red-600'}`; btn.innerText = m.status === 'paid' ? 'ë‚©ë¶€' : 'ë¯¸ë‚©'; } };
        window.saveAdminData = async function() { if (!window.meetingData || !meetingDb) { alert("DB ì—°ê²° ì•ˆë¨"); return; } const bal = parseInt(document.getElementById('admin-total-balance').value) || 0; window.meetingData.totalBalance = bal; const records = window.meetingData.records[window.currentDuesMonth]; if(records) { records.forEach((m, i) => { const val = document.getElementById(`edit-amt-${i}`).value; m.amount = parseInt(val) || 0; }); } try { await setDoc(doc(meetingDb, ...MEETING_PATH), window.meetingData); alert('ì €ì¥ ì™„ë£Œ! âœ…'); window.closeModal('admin-modal'); } catch (e) { console.error(e); alert('ì €ì¥ ì‹¤íŒ¨'); } };
        window.saveScheduleToFirebase = async function() { if (!meetingDb) { alert('DB ì—°ê²° í™•ì¸ ì¤‘...'); return; } const category = document.getElementById('add-sch-category').value; const date = document.getElementById('add-sch-date').value; const time = document.getElementById('add-sch-time').value || 'í•˜ë£¨ ì¢…ì¼'; const title = document.getElementById('add-sch-title').value; if (!date || !title) { alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; } try { await setDoc(doc(meetingDb, ...SCHEDULE_PATH), { [date]: arrayUnion({ type: category, title: title, time: time }) }, { merge: true }); alert('ì¼ì • ë“±ë¡ ì™„ë£Œ! ğŸ—“ï¸'); window.closeModal('schedule-add-modal'); document.getElementById('add-sch-title').value = ''; } catch (e) { console.error(e); alert('ë“±ë¡ ì‹¤íŒ¨'); } };
        window.changeDuesMonth = function(delta) { window.currentDuesMonth += delta; if (window.currentDuesMonth < 1) window.currentDuesMonth = 1; if (window.currentDuesMonth > 12) window.currentDuesMonth = 12; window.renderDues(window.currentDuesMonth); }
        window.updateMeetingUI = function(data) { window.meetingData = data; const balanceEl = document.getElementById('total-balance'); if (balanceEl) balanceEl.innerText = (data.totalBalance || 0).toLocaleString() + "ì›"; window.renderDues(window.currentDuesMonth); };
        
        const memberColors = { 'í™ë°•ì‚¬': { bg: 'bg-blue-100/80', text: 'text-blue-600', char: 'í™' }, 'ë¥˜ì§±': { bg: 'bg-purple-100/80', text: 'text-purple-600', char: 'ë¥˜' }, 'ì˜¤ìŠ¤í‹´': { bg: 'bg-emerald-100/80', text: 'text-emerald-600', char: 'ì˜¤' }, 'ì „ì‹œê¸°': { bg: 'bg-orange-100/80', text: 'text-orange-600', char: 'ì „' }, 'ì§€ë…¸': { bg: 'bg-indigo-100/80', text: 'text-indigo-600', char: 'ì§€' }, 'ì„±ì›ì œ': { bg: 'bg-pink-100/80', text: 'text-pink-600', char: 'ì„±' } };
        window.renderDues = function(month) { const list = document.getElementById('dues-list'); const title = document.getElementById('dues-month-title'); if(!list) return; title.innerText = `${month}ì›” ê¸°ì¤€`; list.innerHTML = ''; let records = []; if (window.meetingData && window.meetingData.records) { records = window.meetingData.records[month] || []; } if (records.length === 0) { list.innerHTML = `<div class="text-center py-8 text-gray-400 text-xs">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; return; } records.forEach((m, i) => { const c = memberColors[m.name] || { bg: 'bg-gray-100', text: 'text-gray-600', char: '?' }; const isPaid = m.status === 'paid'; const cardClass = isPaid ? 'glass-card' : 'glass-card-unpaid'; const amtClass = isPaid ? 'text-blue-500' : 'text-red-500'; const penalty = m.penalty ? `<p class="text-[10px] text-red-500 font-bold mt-1">âš ï¸ ${m.penalty}</p>` : ''; const badge = m.isLeader ? `<span class="ml-1 bg-yellow-100 text-yellow-700 text-[10px] px-1 rounded border border-yellow-200">íšŒì¥ ğŸ‘‘</span>` : ''; list.innerHTML += `<div class="${cardClass} p-4 flex justify-between items-center animate-[fadeInUp_0.3s_ease-out]" style="animation-delay: ${i*0.05}s"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full ${c.bg} flex items-center justify-center text-sm font-bold ${c.text}">${c.char}</div><div><div class="flex items-center"><p class="text-sm font-bold text-main">${m.name}</p>${badge}</div><p class="text-xs text-gray-500">${isPaid ? 'ë‚©ë¶€ ì™„ë£Œ' : 'ë¯¸ë‚©'}</p>${penalty}</div></div><span class="text-sm font-bold ${amtClass}">${isPaid ? m.amount.toLocaleString()+'ì›' : 'ë¯¸ë‚©'}</span></div>`; }); };
        window.renderCalendar = function(year, month) { const grid = document.getElementById('calendar-grid'); const title = document.getElementById('cal-title'); const list = document.getElementById('event-list'); if(!grid) return; title.innerText = `${year}.${String(month + 1).padStart(2, '0')}`; grid.innerHTML = ''; list.innerHTML = ''; const firstDay = new Date(year, month, 1).getDay(); const lastDate = new Date(year, month + 1, 0).getDate(); const events = getMergedEvents(year, month + 1); for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`; let hasEvents = false; let renderedLongTermEvents = new Set(); for(let i=1; i<=lastDate; i++) { const dKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`; const dayEvts = events[dKey]; const isToday = (i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()); let dots = ''; if(dayEvts) { hasEvents = true; dayEvts.forEach(e => { let c = 'bg-blue-500'; if(e.type === 'dues') c = 'bg-emerald-500'; else if(e.type === 'bday') c = 'bg-orange-400'; else if(e.type === 'meet') c = 'bg-purple-500'; else if(e.type === 'anniv') c = 'bg-red-500'; else if(e.type === 'personal') c = 'bg-gray-400'; else if(e.type === 'personal_dot') c = 'bg-gray-300'; dots += `<div class="w-1.5 h-1.5 rounded-full ${c}"></div>`; }); } grid.innerHTML += `<div class="h-14 flex flex-col items-center pt-1 rounded-xl hover:bg-white/20 transition-colors ${isToday ? 'bg-white/50 font-bold text-blue-600 shadow-sm' : 'text-gray-700'}"><span class="text-sm">${i}</span><div class="flex gap-0.5 mt-1 flex-wrap justify-center px-1">${dots}</div></div>`; if(dayEvts) { dayEvts.forEach(e => { if(e.type === 'anniv' && month === 5) { if(!renderedLongTermEvents.has('anniv_6')) { renderedLongTermEvents.add('anniv_6'); list.innerHTML = `<div class="glass-card p-5 flex items-center gap-4 mb-2 animate-[fadeInUp_0.3s_ease-out]"><div class="w-12 h-12 rounded-full bg-white/70 flex items-center justify-center text-2xl shrink-0 shadow-sm text-red-500"><i class="fa-solid fa-cake-candles"></i></div><div><p class="text-xs text-red-500/80 mb-0.5 font-bold">6ì›” 1ì¼ ~ 6ì›” 30ì¼</p><p class="text-lg font-bold text-red-600">${e.title}</p><p class="text-xs text-red-500/80 mt-1">í•œ ë‹¬ ë‚´ë‚´ ì¶•í•˜í•´ìš”!</p></div></div>` + list.innerHTML; } } else if(e.type === 'personal') { if(!renderedLongTermEvents.has(e.title)) { renderedLongTermEvents.add(e.title); list.innerHTML += `<div class="glass-card p-5 flex items-center gap-4 animate-[fadeInUp_0.3s_ease-out]"><div class="w-12 h-12 rounded-full bg-white/70 flex items-center justify-center text-xl shrink-0 shadow-sm text-gray-500"><i class="fa-solid fa-house-user"></i></div><div><p class="text-xs text-gray-500 mb-0.5 font-bold">12.23 ~ 01.23</p><p class="text-base font-bold text-gray-800">${e.title}</p><p class="text-xs text-gray-500 mt-0.5">ì¥ê¸° ì¼ì •ì…ë‹ˆë‹¤</p></div></div>`; } } else if(e.type === 'personal_dot') { } else { let icon = 'fa-check text-gray-500', bg = 'bg-gray-100'; if(e.type === 'dues') { icon = 'fa-coins text-emerald-500'; bg = 'bg-emerald-100'; } else if(e.type === 'bday') { icon = 'fa-cake-candles text-orange-500'; bg = 'bg-orange-100'; } else if(e.type === 'meet') { icon = 'fa-suitcase text-purple-500'; bg = 'bg-purple-100'; } else if(e.type === 'school') { icon = 'fa-school text-blue-500'; bg = 'bg-blue-100'; } const dateStr = `${month + 1}ì›” ${i}ì¼`; list.innerHTML += `<div class="glass-card p-4 flex items-center gap-4 animate-[fadeInUp_0.3s_ease-out]"><div class="w-12 h-12 rounded-full ${bg} flex items-center justify-center text-xl shadow-sm"><i class="fa-solid ${icon}"></i></div><div><p class="text-xs text-gray-500 font-bold">${dateStr} Â· ${e.time}</p><p class="text-base font-bold text-gray-800">${e.title}</p></div></div>`; } }); } } if(!hasEvents) list.innerHTML = `<div class="text-center py-10 text-gray-400"><p class="text-sm">ì¼ì •ì´ ì—†ì–´ìš”</p></div>`; };
        function getMergedEvents(year, month) { const events = {}; const keyPrefix = `${year}-${String(month).padStart(2, '0')}`; const duesDay = '06'; events[`${keyPrefix}-${duesDay}`] = (events[`${keyPrefix}-${duesDay}`] || []).concat([{ type: 'dues', title: 'íšŒë¹„ ë‚©ë¶€ì¼ ğŸ’°', time: '15,000ì›' }]); const birthdays = { '01-02': 'ì „ì‹œê¸° ìƒì¼ ğŸ‚', '03-22': 'ì§€ë…¸ ìƒì¼ ğŸ‚', '04-01': 'ì˜¤ìŠ¤í‹´ ìƒì¼ ğŸ‚', '06-05': 'í™ë°•ì‚¬ ìƒì¼ ğŸ‚', '06-12': 'ë¥˜ì§± ìƒì¼ ğŸ‚', '10-15': 'ì„±ì›ì œ ìƒì¼ ğŸ‚' }; Object.entries(birthdays).forEach(([d, t]) => { const [m, day] = d.split('-'); if (parseInt(m) === month) { const k = `${keyPrefix}-${day}`; events[k] = (events[k] || []).concat([{ type: 'bday', title: t, time: 'í•˜ë£¨ ì¢…ì¼' }]); } }); if(month===6) { const last = new Date(year, month, 0).getDate(); const anniv = year - 2024; for(let i=1; i<=last; i++) { const k = `${keyPrefix}-${String(i).padStart(2,'0')}`; events[k] = (events[k]||[]).concat([{type:'anniv', title:`ì—”ì¡°ì´ ${anniv}ì£¼ë…„ ğŸ‰`, time:'í•˜ë£¨ì¢…ì¼'}]); } } if (year === 2025 && month === 12) { events[`${keyPrefix}-12`] = (events[`${keyPrefix}-12`]||[]).concat([{type:'school', title:'ìš°ì†¡ëŒ€ ì¢…ê°•', time:'ì¼ì •'}]); events[`${keyPrefix}-20`] = (events[`${keyPrefix}-20`]||[]).concat([{type:'school', title:'ì•ˆë™ëŒ€ ì¢…ê°•', time:'ì¼ì •'}]); } if (year === 2025 && month === 2) { ['05', '06', '07'].forEach(day => { const k = `${keyPrefix}-${day}`; events[k] = (events[k]||[]).concat([{type:'meet', title:'ê²½ë¶ì¹ ê³¡, ëŒ€êµ¬ ì—¬í–‰ ğŸš…', time:'ì •ê¸°ëª¨ì„'}]); }); } if (year === 2025 && month === 8) { ['29', '30'].forEach(day => { const k = `${keyPrefix}-${day}`; events[k] = (events[k]||[]).concat([{type:'meet', title:'ì§„ì£¼ ì—¬í–‰ ğŸ°', time:'ì •ê¸°ëª¨ì„'}]); }); } const lastDay = new Date(year, month, 0).getDate(); for(let i=1; i<=lastDay; i++) { const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(i).padStart(2, '0')}`; const currentDate = new Date(dateStr); const sanghoonStart = new Date('2025-12-23'); const sanghoonEnd = new Date('2026-01-23'); if (currentDate >= sanghoonStart && currentDate <= sanghoonEnd) { if(i===1 || currentDate.getTime() === sanghoonStart.getTime()) { events[dateStr] = (events[dateStr]||[]).concat([{type:'personal', title:'ìƒí›ˆì´ ê°œì¸ ì¼ì • ğŸ ', time:'ì¥ê¸° ì¼ì •'}]); } else { events[dateStr] = (events[dateStr]||[]).concat([{type:'personal_dot', title:'ìƒí›ˆì´ ê°œì¸ ì¼ì •', time:''}]); } } } if (window.dynamicEvents) { Object.keys(window.dynamicEvents).forEach(k => { const [dy, dm, dd] = k.split('-').map(Number); if (dy === year && dm === month) { const list = window.dynamicEvents[k]; if(Array.isArray(list)) events[k] = (events[k] || []).concat(list); } }); } return events; }
        function createEmptyMonthData() { const members = ['í™ë°•ì‚¬', 'ë¥˜ì§±', 'ì˜¤ìŠ¤í‹´', 'ì „ì‹œê¸°', 'ì§€ë…¸', 'ì„±ì›ì œ']; return members.map(name => ({ name: name, status: 'unpaid', amount: 0, isLeader: name === 'ì „ì‹œê¸°' })); }
        window.openAddScheduleModal = () => { document.getElementById('schedule-add-modal').classList.remove('hidden'); document.getElementById('schedule-add-modal').classList.add('flex'); };
        window.checkStock = () => {};
        window.goToMusic = () => window.location.href = "https://won429.github.io/enjoy/";
        window.playGame = () => window.location.href = "https://won429.github.io/enjoygame/";

        window.goHome = () => { window.activeTabIndex = 0; window.updateTabUI(0); }
        window.goSchedule = () => { window.activeTabIndex = 1; window.updateTabUI(1); }
        window.goMeeting = () => { window.activeTabIndex = 2; window.updateTabUI(2); }
        window.changeMonth = (delta) => { window.viewMonth += delta; if (window.viewMonth < 0) { window.viewYear--; window.viewMonth = 11; } else if (window.viewMonth > 11) { window.viewYear++; window.viewMonth = 0; } window.renderCalendar(window.viewYear, window.viewMonth); }
        
        // ì¸ì‚¬ë§ ë¡œì§ (ë³µêµ¬ë¨)
        function setGreeting() {
            const hour = new Date().getHours();
            const msgEl = document.getElementById('time-msg');
            const emojiEl = document.getElementById('bg-emoji');
            let msg = '', emoji = '';
            
            if (hour >= 0 && hour < 5) { msg = 'ê³ ìš”í•œ ìƒˆë²½ì´ë„¤ìš” ğŸŒ™'; emoji = 'ğŸŒŒ'; }
            else if (hour >= 5 && hour < 9) { msg = 'ìƒì¾Œí•œ ì•„ì¹¨ì´ì—ìš” â˜€ï¸'; emoji = 'ğŸŒ…'; }
            else if (hour >= 9 && hour < 12) { msg = 'í™œê¸°ì°¬ ì˜¤ì „ ë³´ë‚´ì„¸ìš” â˜˜ï¸'; emoji = 'ğŸŒ¤ï¸'; }
            else if (hour >= 12 && hour < 14) { msg = 'ë§›ìˆëŠ” ì ì‹¬ ë“œì„¸ìš” ğŸ±'; emoji = 'ğŸ½ï¸'; }
            else if (hour >= 14 && hour < 18) { msg = 'ë‚˜ë¥¸í•œ ì˜¤í›„, í˜ë‚´ì„¸ìš” â˜•ï¸'; emoji = 'ğŸ¥'; }
            else if (hour >= 18 && hour < 22) { msg = 'í¸ì•ˆí•œ ì €ë… ë˜ì„¸ìš” ğŸŒ†'; emoji = 'ğŸ·'; }
            else { msg = 'ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³ í–ˆì–´ìš” ğŸŒ™'; emoji = 'âœ¨'; }
            
            if(msgEl) msgEl.innerHTML = msg;
            if(emojiEl) emojiEl.innerHTML = emoji;
        }

        window.onload = () => { 
            setTimeout(() => { document.getElementById('startup-modal').classList.remove('hidden'); document.getElementById('startup-modal').classList.add('flex'); }, 500); 
            setGreeting(); // ì¸ì‚¬ë§ ì‹¤í–‰
            window.renderCalendar(window.viewYear, window.viewMonth); 
            window.updateTabUI(0); 
        };
        
        // CONFIGS & INIT
        const stockConfig = { apiKey: "AIzaSyABn9xi7a-3LyLpvS6HT03gJUGTlQkgHmk", authDomain: "enjoystock.firebaseapp.com", projectId: "enjoystock", storageBucket: "enjoystock.firebasestorage.app", messagingSenderId: "981969177924", appId: "1:981969177924:web:51b0093a0d1b001ead9b11" };
        const meetingConfig = { apiKey: "AIzaSyAVQ_WdMXKuU2CgTgvSHqLKuAVGPeeDuOQ", authDomain: "enjoy-meeting-account.firebaseapp.com", projectId: "enjoy-meeting-account", storageBucket: "enjoy-meeting-account.firebasestorage.app", messagingSenderId: "956113498506", appId: "1:956113498506:web:b520f2b77fdb3295cb9873" };
        const STOCK_PATH = ['artifacts', 'enjoy-stock-live', 'public', 'data', 'stock_data', 'enjoy_ticker'];
        const MEETING_PATH = ['meeting_account', 'dues_status'];
        const SCHEDULE_PATH = ['meeting_account', 'schedules'];

        async function init() {
            try {
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js");
                const { getAuth, signInAnonymously } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js");
                const { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");

                const stockApp = initializeApp(stockConfig, 'stockApp');
                const stockAuth = getAuth(stockApp);
                const stockDb = getFirestore(stockApp);
                await signInAnonymously(stockAuth).catch(() => {});
                onSnapshot(doc(stockDb, ...STOCK_PATH), (docSnap) => { if (docSnap.exists()) updateStockUI(docSnap.data()); });

                const meetingApp = initializeApp(meetingConfig, 'meetingApp');
                const meetingAuth = getAuth(meetingApp);
                meetingDb = getFirestore(meetingApp);
                window.meetingDb = meetingDb; 

                await signInAnonymously(meetingAuth).catch((e) => console.warn('Meeting Auth Failed', e));

                onSnapshot(doc(meetingDb, ...MEETING_PATH), (docSnap) => {
                    if (docSnap.exists()) { window.updateMeetingUI(docSnap.data()); } 
                    else { const initialData = getInitialMeetingData(); setDoc(doc(meetingDb, ...MEETING_PATH), initialData); }
                });

                onSnapshot(doc(meetingDb, ...SCHEDULE_PATH), (docSnap) => {
                    if (docSnap.exists()) { window.dynamicEvents = docSnap.data(); window.renderCalendar(window.viewYear, window.viewMonth); } 
                    else { setDoc(doc(meetingDb, ...SCHEDULE_PATH), {}); }
                });
            } catch(e) { console.error("Firebase Init Error:", e); }
        }

        function updateStockUI(data) {
            const priceEl = document.getElementById('ticker-price'); const changeEl = document.getElementById('ticker-change');
            const base = data.basePrice || 1250; const currentPrice = data.currentPrice;
            priceEl.innerText = currentPrice.toLocaleString() + "ì›";
            const diff = currentPrice - base; const rate = ((diff / base) * 100).toFixed(1); const sign = diff > 0 ? '+' : '';
            if (diff > 0) { priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-red-500 price-up`; changeEl.className = "text-sm font-bold tabular-nums text-red-500 mb-0.5"; changeEl.innerText = `${sign}${rate}%`; } 
            else if (diff < 0) { priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-blue-500 price-down`; changeEl.className = "text-sm font-bold tabular-nums text-blue-500 mb-0.5"; changeEl.innerText = `${rate}%`; } 
            else { changeEl.className = "text-sm font-bold tabular-nums text-gray-400 mb-0.5"; changeEl.innerText = "0.0%"; }
        }

        init();
    </script>
</body>
</html>