<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy - Toss Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face {
            font-family: 'TossFaceFontMac';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface-font-mac.css');
        }

        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            background-color: #F2F4F6; /* í† ìŠ¤ ì‹œê·¸ë‹ˆì²˜ ë°°ê²½ìƒ‰ */
            color: #191F28; /* í† ìŠ¤ ë¸”ë™ */
            -webkit-tap-highlight-color: transparent;
        }

        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ì¹´ë“œ */
        .toss-card {
            background: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); 
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        .toss-card:active {
            transform: scale(0.96);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.02);
        }

        /* í…ìŠ¤íŠ¸ ì»¬ëŸ¬ ì‹œìŠ¤í…œ */
        .text-main { color: #191F28; }
        .text-sub { color: #8B95A1; }
        .text-blue { color: #3182F6; } /* í† ìŠ¤ ë¸”ë£¨ */
        .text-red { color: #F04452; } /* í† ìŠ¤ ë ˆë“œ */

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe-area { padding-bottom: env(safe-area-inset-bottom); } 
        
        /* ê°€ê²© ë“±ë½ ìƒ‰ìƒ (ì• ë‹ˆë©”ì´ì…˜ìš©) */
        .price-up { color: #F04452 !important; transition: color 0.3s; }
        .price-down { color: #3182F6 !important; transition: color 0.3s; }

        /* ë°°ê²½ ì´ëª¨í‹°ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .bg-emoji {
            animation: floatEmoji 6s ease-in-out infinite;
            filter: blur(0px); 
        }
    </style>
</head>
<body class="w-full h-[100dvh] flex flex-col overflow-hidden">

    <!-- ìƒë‹¨ í—¤ë” (ì‹¬í”Œ) -->
    <header class="flex-none pt-safe px-6 pb-2 z-20 flex justify-between items-center bg-[#F2F4F6]">
        <div class="flex items-center gap-1.5 opacity-0 animate-[fadeIn_0.5s_0.5s_forwards]">
            <span class="text-xl font-bold text-main tracking-tight">Enjoy</span>
        </div>
        <!-- ì•Œë¦¼ ë²„íŠ¼ ì‚­ì œë¨ -->
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-2 pb-32 w-full max-w-md mx-auto relative">
        
        <!-- ğŸ‘‹ ìƒë‹¨ ì¸ì‚¬ë§ (ë°°ê²½ ì´ëª¨í‹°ì½˜ ìš°ì¸¡ ë°°ì¹˜) -->
        <div class="mb-6 mt-2 fade-in-up relative h-24 flex flex-col justify-center overflow-visible">
            <!-- ë°°ê²½ ì´ëª¨í‹°ì½˜ (ìš°ì¸¡ ë°°ì¹˜: right-0) -->
            <div id="bg-emoji" class="bg-emoji absolute right-0 bottom-[-10px] text-[80px] opacity-20 select-none pointer-events-none z-0 transform translate-x-2">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì´ëª¨í‹°ì½˜ ì£¼ì… -->
            </div>

            <!-- í…ìŠ¤íŠ¸ (ìƒëŒ€ ìœ„ì¹˜, z-index ë†’ìŒ) -->
            <div class="relative z-10">
                <h1 class="text-2xl font-bold text-main leading-tight mb-1">
                    ì—”ì¡°ì´ ì—¬ëŸ¬ë¶„,
                </h1>
                <p id="time-msg" class="text-2xl font-bold text-main leading-tight opacity-90">
                    <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë©˜íŠ¸ ì£¼ì… -->
                </p>
            </div>
        </div>

        <!-- ì„¹ì…˜ 1: ìì‚°/ì£¼ì‹ (ìˆ˜ì •ë¨: íˆ¬ìë‚´ì—­ ì‚­ì œ, ì£¼ì‹ëª… ë³€ê²½) -->
        <div class="toss-card p-6 mb-4 fade-in-up delay-100 group" onclick="checkStock()">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-main">ì—”ì¡°ì´ ì¦ê¶Œ</h2>
                <i class="fa-solid fa-chevron-right text-sub text-xs group-hover:translate-x-1 transition-transform"></i>
            </div>
            
            <div class="flex items-center justify-between relative z-10 pb-2">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 text-xl shadow-sm">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <!-- 'ë‚´ ì£¼ì‹' -> 'ì—”ì¡°ì´'ë¡œ ë³€ê²½ -->
                            <p class="text-sm font-medium text-sub">ì—”ì¡°ì´</p> 
                            <span id="market-badge" class="hidden text-[10px] font-bold bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded-md">ë§ˆê°</span>
                        </div>
                        <div class="flex items-end gap-2">
                            <h3 id="ticker-price" class="text-2xl font-bold text-main tabular-nums tracking-tight">Loading...</h3>
                            <span id="ticker-change" class="text-sm font-medium text-sub mb-1 tabular-nums">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë°°ê²½ ì°¨íŠ¸ (ì€ì€í•˜ê²Œ) -->
            <div class="absolute bottom-0 right-0 w-[60%] h-[50%] opacity-20 pointer-events-none">
                 <svg id="mini-chart" width="100%" height="100%" preserveAspectRatio="none" class="overflow-visible">
                    <defs>
                        <linearGradient id="chart-grad" x1="0" x2="0" y1="0" y2="1">
                            <stop offset="0%" stop-color="#3182F6" stop-opacity="0.5"/>
                            <stop offset="100%" stop-color="#3182F6" stop-opacity="0"/>
                        </linearGradient>
                    </defs>
                    <path id="chart-fill" d="" fill="url(#chart-grad)"></path>
                    <polyline id="chart-line" points="" fill="none" stroke="#3182F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline>
                 </svg>
            </div>
        </div>

        <!-- ì„¹ì…˜ 2: ì—”ì¡°ì´ ì„œë¹„ìŠ¤ (ê³„ì¸µí˜• ë ˆì´ì•„ì›ƒ) -->
        <h3 class="text-lg font-bold text-main mb-3 px-1 fade-in-up delay-200">ì—”ì¡°ì´ ì„œë¹„ìŠ¤</h3>
        
        <!-- 1. ë©”ì¸ ì„œë¹„ìŠ¤ (ìŒì•…) - ê°€ë¡œë¡œ ë„“ê²Œ ê°•ì¡° -->
        <div class="mb-3 fade-in-up delay-200">
            <button onclick="goToMusic()" class="toss-card w-full p-6 flex flex-row-reverse items-center justify-between group overflow-hidden relative h-32 bg-[#E8F3FF]">
                <!-- ì•„ì´ì½˜ ì˜ì—­ -->
                <div class="relative z-10 w-16 h-16 rounded-full bg-white/60 backdrop-blur-sm shadow-sm flex items-center justify-center text-blue-500 text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="fa-solid fa-headphones"></i>
                </div>
                
                <!-- í…ìŠ¤íŠ¸ ì˜ì—­ -->
                <div class="relative z-10 text-left flex-1 pr-4">
                    <div class="flex items-center gap-1.5 mb-1.5">
                        <span class="text-[10px] font-bold text-blue-500 bg-white/80 px-1.5 py-0.5 rounded-md">TODAY</span>
                        <span class="w-1 h-1 rounded-full bg-blue-500"></span>
                        <span class="text-[10px] font-medium text-blue-400">ìŒì•…</span>
                    </div>
                    <!-- ìˆ˜ì •ë¨: ì—”ì¡°ì´ ë¸Œì´ë¡œê·¸ ì† ìŒì•… ë“£ê¸° -->
                    <h4 class="text-xl font-bold text-main leading-tight mb-1">ì—”ì¡°ì´ ë¸Œì´ë¡œê·¸ ì†<br>ìŒì•… ë“£ê¸°</h4>
                </div>
            </button>
        </div>

        <!-- 2. ì„œë¸Œ ì„œë¹„ìŠ¤ (ê²Œì„, ì—¬í–‰) - 2ì—´ ê·¸ë¦¬ë“œ -->
        <div class="grid grid-cols-2 gap-3 mb-3 fade-in-up delay-200">
            <!-- ê²Œì„ -->
            <button onclick="playGame()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group bg-[#FFF0F0] hover:bg-[#FFE5E5] transition-colors">
                <div class="w-full flex justify-between items-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 flex items-center justify-center text-[#FF6B6B] text-xl group-hover:rotate-12 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-dice"></i>
                    </div>
                    <span class="bg-[#FF6B6B] text-white text-[9px] font-bold px-1.5 py-0.5 rounded-md tracking-tight">NEW</span>
                </div>
                <div>
                    <!-- ìˆ˜ì •ë¨: ì—”ì¡°ì´ ë³µë¶ˆë³µ -->
                    <h4 class="text-lg font-bold text-main mb-1">ì—”ì¡°ì´ ë³µë¶ˆë³µ</h4>
                    <!-- ìˆ˜ì •ë¨: ì—”ì¡°ì´ì˜ ìš´ëª…ì€? -->
                    <p class="text-xs text-[#FF6B6B]/80 font-medium leading-snug">ì—”ì¡°ì´ì˜<br>ìš´ëª…ì€?</p>
                </div>
            </button>

            <!-- ì—¬í–‰ -->
            <button onclick="showTravelModal()" class="toss-card p-5 h-44 flex flex-col justify-between text-left group bg-[#E3FAEB] hover:bg-[#D1F7DE] transition-colors">
                <div class="w-full flex justify-start">
                    <div class="w-12 h-12 rounded-[18px] bg-white/60 flex items-center justify-center text-[#00C77D] text-xl group-hover:scale-110 transition-transform duration-300 shadow-sm">
                        <i class="fa-solid fa-plane-departure"></i>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-main mb-1">ì—¬í–‰ ê¸°ë¡</h4>
                    <p class="text-xs text-[#00C77D]/80 font-medium leading-snug">ì§€ë‚œ ì¶”ì–µì„<br>ë– ì˜¬ë ¤ë´ìš”</p>
                </div>
            </button>
        </div>

        <!-- 3. ê¸°íƒ€ (ì¤€ë¹„ ì¤‘) - ìŠ¬ë¦¼í•œ í•˜ë‹¨ ë°°ë„ˆ -->
        <div class="mb-6 fade-in-up delay-200">
            <button onclick="showSecretModal()" class="w-full h-14 bg-white rounded-2xl px-5 flex items-center justify-between shadow-sm active:scale-[0.98] transition-transform">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center text-xs">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-500">ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘</span>
                </div>
                <div class="text-xs text-gray-300 font-medium flex items-center gap-1">
                    Comming Soon <i class="fa-solid fa-chevron-right text-[10px]"></i>
                </div>
            </button>
        </div>

        <!-- ì—”ì¡°ì´ í”„ë¼ì„ ë°°ë„ˆ ì‚­ì œë¨ -->

        <div class="mt-8 text-center pb-8">
            <button class="text-xs text-sub underline hover:text-gray-600">í™”ë©´ í¸ì§‘í•˜ê¸°</button>
            <p class="text-[10px] text-gray-300 mt-4">Â© 2024 Enjoy Corp.</p>
        </div>
    </main>

    <!-- í•˜ë‹¨ í”Œë¡œíŒ… ë©”ë‰´ (ê°•í™”ëœ ë¦¬ì–¼ ê¸€ë˜ìŠ¤ ëª¨í”¼ì¦˜) -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 w-auto">
        <!-- ë©”ì¸ ì•Œì•½ ë©”ë‰´ -->
        <!-- 
             bg-white/10: íˆ¬ëª…ë„ ëŒ€í­ ì¦ê°€ (ë” íˆ¬ëª…í•˜ê²Œ)
             backdrop-blur-xl: ë¸”ëŸ¬ íš¨ê³¼ ê°•í™” (ë’¤ì— ì½˜í…ì¸ ê°€ ë­‰ê°œì ¸ ë³´ì´ë„ë¡)
             border-white/30: ìœ ë¦¬ì˜ ë‘ê»˜ê° í‘œí˜„ì„ ìœ„í•œ ì–‡ì€ í…Œë‘ë¦¬
             shadow-lg: ë¶• ë– ìˆëŠ” ëŠë‚Œ
        -->
        <div class="flex items-center bg-white/10 backdrop-blur-2xl shadow-[0_8px_32px_0_rgba(31,38,135,0.1)] border border-white/30 rounded-full p-1 gap-1 ring-1 ring-white/20">
            
            <!-- 1. í™ˆ (í™œì„±í™” ìƒíƒœ) -->
            <button class="relative px-5 py-2 rounded-full transition-all duration-300 group min-w-[64px]">
                <!-- í™œì„±í™” ë°°ê²½ (ë°˜íˆ¬ëª… í™”ì´íŠ¸ + ìì²´ ë¸”ëŸ¬) -->
                <div class="absolute inset-0 bg-white/50 shadow-[inset_0_1px_1px_rgba(255,255,255,0.6)] rounded-full backdrop-blur-md"></div>
                <!-- ì•„ì´ì½˜ ë° í…ìŠ¤íŠ¸ -->
                <div class="relative z-10 flex flex-col items-center gap-0.5">
                    <i class="fa-solid fa-house text-base text-[#191F28] drop-shadow-sm"></i>
                    <span class="text-[10px] font-bold text-[#191F28] drop-shadow-sm">í™ˆ</span>
                </div>
            </button>

            <!-- 2. ëª¨ì„í†µì¥ (ë¹„í™œì„±í™” ìƒíƒœ) -->
            <button onclick="alert('ëª¨ì„í†µì¥ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì´ì—ìš”!')" class="relative px-5 py-2 rounded-full transition-all duration-300 group min-w-[64px] hover:bg-white/10">
                <div class="relative z-10 flex flex-col items-center gap-0.5">
                    <i class="fa-solid fa-users text-base text-[#4E5968] group-hover:text-gray-800 transition-colors"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-800 transition-colors">ëª¨ì„í†µì¥</span>
                </div>
            </button>

        </div>
    </nav>

    <!-- ëª¨ë‹¬: ì—…ë°ì´íŠ¸ (í† ìŠ¤ ìŠ¤íƒ€ì¼) -->
    <div id="startup-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center relative overflow-hidden">
            <h3 class="text-xl font-bold text-main mb-3 mt-2">ë°˜ê°€ì›Œìš”! ğŸ‘‹</h3>
            <p class="text-[#4E5968] text-sm mb-8 leading-relaxed">
                ì´ì œ í™ˆ í™”ë©´ì—ì„œ <span class="text-blue-500 font-bold">ì‹¤ì‹œê°„ ì£¼ê°€</span>ë¥¼<br>í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
            </p>
            <div class="flex gap-3">
                <button onclick="closeModal('startup-modal')" class="flex-1 bg-[#F2F4F6] text-[#4E5968] font-bold py-3.5 rounded-xl hover:bg-gray-200 transition-colors">
                    ë‚˜ì¤‘ì—
                </button>
                <button onclick="closeModal('startup-modal')" class="flex-1 bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20">
                    í™•ì¸í–ˆì–´ìš”
                </button>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ê³µí†µ -->
    <div id="common-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center">
            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-500 text-xl" id="modal-icon-bg">
                <i id="modal-icon" class=""></i>
            </div>
            <h3 class="text-lg font-bold text-main mb-2" id="modal-title">ì œëª©</h3>
            <p class="text-[#4E5968] text-sm mb-6 leading-relaxed break-keep" id="modal-desc">ë‚´ìš©</p>
            <button onclick="closeModal('common-modal')" class="w-full bg-[#3182F6] text-white font-bold py-3.5 rounded-xl hover:bg-blue-600 transition-colors shadow-md shadow-blue-500/20">
                í™•ì¸
            </button>
        </div>
    </div>

    <!-- ğŸ”¥ FIREBASE ì—°ë™ ğŸ”¥ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyABn9xi7a-3LyLpvS6HT03gJUGTlQkgHmk",
            authDomain: "enjoystock.firebaseapp.com",
            projectId: "enjoystock",
            storageBucket: "enjoystock.firebasestorage.app",
            messagingSenderId: "981969177924",
            appId: "1:981969177924:web:51b0093a0d1b001ead9b11"
        };

        const DATA_PATH = ['artifacts', 'enjoy-stock-live', 'public', 'data', 'stock_data', 'enjoy_ticker'];
        
        const priceEl = document.getElementById('ticker-price');
        const changeEl = document.getElementById('ticker-change');
        const polyline = document.getElementById('chart-line');
        const pathFill = document.getElementById('chart-fill');
        const svg = document.getElementById('mini-chart');
        const marketBadge = document.getElementById('market-badge');
        
        const MARKET_START = 8 * 60; 
        const MARKET_END = 23 * 60 + 30;

        function checkMarketStatus(manualPause) {
            const now = new Date();
            const curr = now.getHours() * 60 + now.getMinutes();
            const isOpen = (curr >= MARKET_START && curr < MARKET_END) && !manualPause;
            
            if (!isOpen) {
                marketBadge.classList.remove('hidden');
                marketBadge.innerText = manualPause ? "ì¼ì‹œì •ì§€" : "ë§ˆê°";
            } else {
                marketBadge.classList.add('hidden');
            }
        }

        function drawChart(history, basePrice) {
            if (!svg || !history || history.length === 0) return;
            const w = svg.clientWidth || 64;
            const h = svg.clientHeight || 32;
            
            let min = Math.min(...history, basePrice);
            let max = Math.max(...history, basePrice);
            const pad = (max - min) * 0.1 || 10;
            min -= pad; max += pad;
            const range = max - min;

            const pts = history.map((val, i) => {
                const x = (i / (history.length - 1)) * w;
                const y = h - ((val - min) / range) * h;
                return `${x},${y}`;
            }).join(' ');

            polyline.setAttribute('points', pts);
            pathFill.setAttribute('d', `M ${pts} L ${w},${h} L 0,${h} Z`);
        }

        function updateUI(data) {
            if (!data) return;

            const { currentPrice, basePrice, history, manualPause } = data;
            const base = basePrice || 12000;

            // 1. ìƒíƒœ ì—…ë°ì´íŠ¸
            checkMarketStatus(manualPause);

            // 2. ê°€ê²© í‘œì‹œ
            priceEl.innerText = currentPrice.toLocaleString() + "ì›";
            
            // 3. ë“±ë½ í‘œì‹œ
            const diff = currentPrice - base;
            const rate = ((diff / base) * 100).toFixed(1);
            const sign = diff > 0 ? '+' : '';
            
            // ë„¤ì˜¨ ìƒ‰ìƒ ì ìš©
            const redColor = '#F04452'; // Toss Red
            const blueColor = '#3182F6'; // Toss Blue
            const glowClass = 'text-glow';

            if (diff > 0) {
                priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-red-500 price-up`;
                changeEl.className = "text-sm font-bold tabular-nums text-red-500 mb-0.5";
                changeEl.innerText = `${sign}${rate}%`;
                polyline.setAttribute('stroke', redColor);
                // ê·¸ë¼ë°ì´ì…˜ ì—…ë°ì´íŠ¸ (Red)
                svg.querySelector('stop:first-child').setAttribute('stop-color', redColor);
                svg.querySelector('stop:last-child').setAttribute('stop-color', redColor);
            } else if (diff < 0) {
                priceEl.className = `text-2xl font-bold tabular-nums tracking-tight text-blue-500 price-down`;
                changeEl.className = "text-sm font-bold tabular-nums text-blue-500 mb-0.5";
                changeEl.innerText = `${rate}%`;
                polyline.setAttribute('stroke', blueColor);
                // ê·¸ë¼ë°ì´ì…˜ ì—…ë°ì´íŠ¸ (Blue)
                svg.querySelector('stop:first-child').setAttribute('stop-color', blueColor);
                svg.querySelector('stop:last-child').setAttribute('stop-color', blueColor);
            } else {
                changeEl.className = "text-sm font-bold tabular-nums text-gray-400 mb-0.5";
                changeEl.innerText = "0.0%";
                polyline.setAttribute('stroke', '#B0B8C1');
            }

            // 4. ì°¨íŠ¸
            if (history) drawChart(history, base);
        }

        async function init() {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                
                await signInAnonymously(auth).catch(() => {});
                
                onSnapshot(doc(db, ...DATA_PATH), (docSnap) => {
                    if (docSnap.exists()) updateUI(docSnap.data());
                });
            } catch(e) { console.error(e); }
        }
        init();
    </script>

    <!-- ì¼ë°˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        const LINKS = {
            music: "https://won429.github.io/enjoy/",
            stock: "https://won429.github.io/enjoystock/",
            game: "https://won429.github.io/enjoygame/"
        };

        function showModal(id, title, desc, iconClass, iconColorClass) {
            const modal = document.getElementById(id);
            if(title) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-desc').innerHTML = desc;
                const iconBg = document.getElementById('modal-icon-bg');
                const icon = document.getElementById('modal-icon');
                icon.className = iconClass;
                // ì•„ì´ì½˜ ë°°ê²½ìƒ‰ ì»¤ìŠ¤í…€
                if(iconColorClass) {
                    iconBg.className = `w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl ${iconColorClass}`;
                } else {
                    iconBg.className = "w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-500 text-xl";
                }
            }
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        function closeModal(id) {
            const modal = document.getElementById(id);
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function goToMusic() { if (LINKS.music) window.location.href = LINKS.music; }
        function checkStock() { if (LINKS.stock) window.location.href = LINKS.stock; }
        function playGame() { if (LINKS.game) window.location.href = LINKS.game; }

        function showTravelModal() {
            showModal('common-modal', 'Coming Soon', 'ì—¬í–‰ ê¸°ë¡ ì„œë¹„ìŠ¤ëŠ”<br>í˜„ì¬ ì¤€ë¹„ ì¤‘ì´ì—ìš” âœˆï¸', 'fa-solid fa-plane', 'bg-emerald-50 text-emerald-500');
        }
        function showSecretModal() {
            showModal('common-modal', 'ë‹¤ìŒ ì„œë¹„ìŠ¤ëŠ”?', 'ì–´ë–¤ ê¸°ëŠ¥ì´ ì¶”ê°€ë ê¹Œìš”?<br>ê¸°ëŒ€í•´ ì£¼ì„¸ìš”! ğŸ', 'fa-solid fa-lock', 'bg-gray-100 text-gray-400');
        }

        // ğŸ‘‹ ì‹œê°„ëŒ€ë³„ ì„œë¸Œ ë©˜íŠ¸ ì„¤ì • (ë°°ê²½ ì´ëª¨í‹°ì½˜ ìš°ì¸¡)
        function setGreeting() {
            const hour = new Date().getHours();
            const msgEl = document.getElementById('time-msg');
            const emojiEl = document.getElementById('bg-emoji');
            let msg = '';
            let emoji = '';

            if (hour >= 5 && hour < 12) {
                msg = 'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! ìƒì¾Œí•œ í•˜ë£¨ ì‹œì‘í•˜ì„¸ìš”';
                emoji = 'â˜€ï¸';
            } else if (hour >= 12 && hour < 14) {
                msg = 'ë§›ìˆëŠ” ì ì‹¬ ë“œì…¨ë‚˜ìš”? ì˜¤í›„ë„ íŒŒì´íŒ…!';
                emoji = 'ğŸ±';
            } else if (hour >= 14 && hour < 18) {
                msg = 'ë‚˜ë¥¸í•œ ì˜¤í›„ë„¤ìš”, ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”!';
                emoji = 'â˜•ï¸';
            } else if (hour >= 18 && hour < 22) {
                msg = 'ì˜¤ëŠ˜ í•˜ë£¨ ê³ ìƒí•˜ì…¨ì–´ìš”. í¸ì•ˆí•œ ì €ë… ë˜ì„¸ìš”';
                emoji = 'ğŸŒ™';
            } else {
                msg = 'ë°¤ì´ ê¹Šì—ˆì–´ìš”. ì¢‹ì€ ê¿ˆ ê¾¸ì„¸ìš”';
                emoji = 'âœ¨';
            }
            msgEl.innerHTML = msg;
            emojiEl.innerHTML = emoji;
        }

        window.addEventListener('DOMContentLoaded', () => {
            setGreeting(); // ì‹œê°„ëŒ€ë³„ ë©˜íŠ¸ ì„¤ì •
            
            setTimeout(() => {
                const startModal = document.getElementById('startup-modal');
                startModal.classList.remove('hidden');
                startModal.classList.add('flex');
            }, 500);
        });
    </script>
</body>
</html>